<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="color-scheme" content="light only">
    <meta name="supported-color-schemes" content="light">
    <style>
        html{color-scheme:light only!important;-webkit-color-scheme:light!important;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)!important}
        body{color-scheme:light only!important;-webkit-color-scheme:light!important}
    </style>
    <script>
        (function(){document.documentElement.style.colorScheme='light';document.documentElement.style.webkitColorScheme='light';})();
    </script>
    <title>Â∞èÁôΩÊú∫</title>
    <link rel="stylesheet" href="css/base.css?v=10">
    <link rel="stylesheet" href="css/phone.css?v=10">
    <link rel="stylesheet" href="css/settings.css?v=10">
    <link rel="stylesheet" href="css/home.css?v=10">
    <link rel="stylesheet" href="css/apps.css?v=10">
    <link rel="stylesheet" href="css/linee-all.css?v=10">
    <link rel="stylesheet" href="css/diary.css?v=10">
    <link rel="stylesheet" href="css/force-light.css?v=10">
    <meta name="color-scheme" content="light">
    <meta name="theme-color" content="#A0D8EF">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <link rel="stylesheet" href="css/worldbook.css?v=10">
    <link rel="stylesheet" href="css/chat-settings.css?v=10">
    <link rel="stylesheet" href="css/responsive.css?v=10">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Scoped Tailwind-like overrides if necessary to prevent global breakage */
        #phone-frame { font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
    </style>
</head>
<body>
    <div id="phone-container">
        <div id="phone-frame">
            <div id="notch"></div>
            <div id="status-bar">
                <span id="status-time"></span>
                <span id="status-battery">
                    <span id="battery-level">100%</span>
                    <span id="battery-icon">üîã</span>
                </span>
            </div>
            <div id="pull-hint" style="background:transparent;display:none">‚¨á ‰∏ãÊãâÊâìÂºÄËÆæÁΩÆ / ÁÇπÂáªÁÅµÂä®Â≤õ ‚¨Ü</div>

            <div id="settings-page" class="hidden">
                <div class="settings-header">
                    <h2>ËÆæÁΩÆ</h2>
                    <button id="close-settings">√ó</button>
                </div>
                <div class="settings-content">
                    <div class="settings-tabs">
                        <button class="tab-btn active" data-tab="api">API</button>
                        <button class="tab-btn" data-tab="font">Â≠ó‰Ωì</button>
                        <button class="tab-btn" data-tab="beauty">ÁæéÂåñ</button>
                    </div>

                    <div class="tab-content active" id="tab-api">
                        <h3>ü§ñ API ÈÖçÁΩÆ</h3>
                        <div style="font-size:11px;color:#999;margin-bottom:10px">‚ö† ‰∏çÈúÄË¶ÅÂä† /v1</div>
                        <input type="text" id="api-url" placeholder="API Âèç‰ª£Âú∞ÂùÄ">
                        <input type="password" id="api-key" placeholder="API ÂØÜÈí•">
                        <button id="fetch-models">ÊãâÂèñÊ®°Âûã</button>
                        <select id="model-select"><option>ËØ∑ÂÖàÊãâÂèñÊ®°Âûã</option></select>
                        <label>Ê®°ÂûãÊ∏©Â∫¶: <span id="temp-value">0.7</span></label>
                        <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" style="width:100%">
                        <label style="display:flex;align-items:center;gap:10px;margin:15px 0">
                            <input type="checkbox" id="enable-system-role">ÂêØÁî®ÂêéÂè∞ËßíËâ≤
                        </label>
                        <div style="font-size:11px;color:red;margin-top:-10px;margin-bottom:15px">‚ö† ÂºÄÂêØÂêéÂ∞ÜËá™Âä®Â¢ûÂä†È¢ùÂ∫¶Ë∞ÉÁî®</div>
                        
                        <h4>üíæ API ÈÖçÁΩÆÂàóË°®</h4>
                        <div style="display:flex;gap:10px;margin-bottom:10px">
                            <input type="text" id="api-config-name" placeholder="ÈÖçÁΩÆÂêçÁß∞" style="flex:1">
                            <button id="save-api-config" style="margin:0">‰øùÂ≠ò</button>
                        </div>
                        <select id="api-config-list" size="4" style="width:100%;margin-bottom:10px;padding:8px;border-radius:10px;border:2px solid #e8e8e8"></select>
                        <div style="display:flex;gap:10px">
                            <button id="load-api-config" style="flex:1;margin:0;background:linear-gradient(135deg,#28a745,#20873a)">Âä†ËΩΩÈÄâ‰∏≠</button>
                            <button id="delete-api-config" style="flex:1;margin:0;background:linear-gradient(135deg,#dc3545,#c82333)">Âà†Èô§ÈÄâ‰∏≠</button>
                        </div>
                        
                        <h4 style="margin-top:20px">üéô Minimax TTS</h4>
                        <div style="font-size:11px;color:#666;margin-bottom:10px">ËØ•ËÆæÁΩÆÁî®‰∫éÊèê‰æõAIËØ≠Èü≥‰ø°ÊÅØ</div>
                        <input type="text" id="minimax-group-id" placeholder="Minimax Group ID">
                        <input type="password" id="minimax-api-key" placeholder="Minimax API Key">
                        <button id="fetch-tts-models">ÊãâÂèñËØ≠Èü≥Ê®°Âûã</button>
                        <select id="tts-model-select"><option>ËØ∑ÂÖàÊãâÂèñÊ®°Âûã</option></select>
                        
                        <h4 style="margin-top:15px">üíæ TTS ÈÖçÁΩÆÂàóË°®</h4>
                        <div style="display:flex;gap:10px;margin-bottom:10px">
                            <input type="text" id="tts-config-name" placeholder="ÈÖçÁΩÆÂêçÁß∞" style="flex:1">
                            <button id="save-tts-config" style="margin:0">‰øùÂ≠ò</button>
                        </div>
                        <select id="tts-config-list" size="3" style="width:100%;margin-bottom:10px;padding:8px;border-radius:10px;border:2px solid #e8e8e8"></select>
                        <div style="display:flex;gap:10px">
                            <button id="load-tts-config" style="flex:1;margin:0;background:linear-gradient(135deg,#28a745,#20873a)">Âä†ËΩΩÈÄâ‰∏≠</button>
                            <button id="delete-tts-config" style="flex:1;margin:0;background:linear-gradient(135deg,#dc3545,#c82333)">Âà†Èô§ÈÄâ‰∏≠</button>
                        </div>
                        
                        <button id="save-api" style="width:100%;margin-top:25px">‰øùÂ≠òÂΩìÂâçÊâÄÊúâËÆæÂÆö</button>
                        <div style="display:flex;gap:10px;margin-top:10px">
                            <button id="export-api" style="flex:1;margin:0">ÂØºÂá∫ API ËÆæÂÆö</button>
                            <button id="import-api" style="flex:1;margin:0">ÂØºÂÖ• API ËÆæÂÆö</button>
                        </div>
                        
                        <h4 style="margin-top:25px;color:#d9534f">üì¶ ÂÖ®Êú∫Êï∞ÊçÆ</h4>
                        <div class="btn-group">
                            <button id="export-all-data" style="background:linear-gradient(135deg,#28a745,#20873a)">ÂØºÂá∫ÂÖ®Êú∫Êï∞ÊçÆ</button>
                            <button id="import-all-data" style="background:linear-gradient(135deg,#17a2b8,#138496)">ÂØºÂÖ•ÂÖ®Êú∫Êï∞ÊçÆ</button>
                            <button id="clear-all-data" style="background:linear-gradient(135deg,#dc3545,#c82333)">Ê∏ÖÈô§Êú¨Êú∫Êï∞ÊçÆ</button>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-font">
                        <h3>üî§ Â≠ó‰ΩìËÆæÁΩÆ</h3>
                        <a href="https://www.tsanger.cn/" target="_blank" style="display:inline-block;padding:10px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;text-decoration:none;border-radius:10px;margin-bottom:15px;font-size:13px">üåê Êõ¥Â§öÂ≠ó‰ΩìÔºàÈúÄË¶ÅÈ≠îÊ≥ïÔºâ</a>
                        <label>Â≠ó‰Ωì URL:</label>
                        <input type="text" id="font-url" placeholder="ËæìÂÖ•Â≠ó‰Ωì URL (.ttf, .woff, .woff2)">
                        <button id="apply-font-url">Â∫îÁî® URL Â≠ó‰Ωì</button>
                        <label style="margin-top:15px">Êú¨Âú∞Â≠ó‰Ωì:</label>
                        <input type="file" id="font-upload" accept=".ttf,.woff,.woff2">
                        <button id="apply-font-file">Â∫îÁî®Êú¨Âú∞Â≠ó‰Ωì</button>
                        <div id="font-preview" style="margin:20px 0;padding:20px;background:rgba(0,0,0,0.05);border-radius:15px;text-align:center">
                            <div style="font-size:14px;color:#666;margin-bottom:10px">Â≠ó‰ΩìÈ¢ÑËßà</div>
                            <div id="preview-text" style="font-size:18px">Ê¨¢Ëøé‰ΩøÁî®Â∞èÁôΩÊú∫</div>
                        </div>
                        <button id="reset-font">ÊÅ¢Â§çÈªòËÆ§Â≠ó‰Ωì</button>
                    </div>

                    <div class="tab-content" id="tab-beauty">
                        <h3>üé® ‰∏ªÈ¢ò</h3>
                        <div class="theme-grid">
                            <button class="theme-btn" data-theme="cinnamoroll">ÁéâÊ°ÇÁãó</button>
                            <button class="theme-btn" data-theme="hellokitty">Hello Kitty</button>
                            <button class="theme-btn" data-theme="kuromi">Â∫ìÊ¥õÁ±≥</button>
                            <button class="theme-btn" data-theme="mymelody">Áæé‰πêËíÇ</button>
                        </div>
                        <h3 style="margin-top:20px">‚ú® Ëá™ÂÆö‰πâ</h3>
                        <label>Â£ÅÁ∫∏ URL:</label>
                        <input type="text" id="wallpaper-url" placeholder="ËæìÂÖ•Â£ÅÁ∫∏ÂõæÁâá URL">
                        <button id="apply-wallpaper-url">‰øùÂ≠òÂ£ÅÁ∫∏</button>
                        <label style="margin-top:10px">Êú¨Âú∞Â£ÅÁ∫∏: <input type="file" id="wallpaper-upload" accept="image/*"></label>
                        <label>ËæπÊ°ÜÈ¢úËâ≤: <input type="color" id="frame-color"></label>
                        <button id="toggle-fullscreen">Âº∫Âà∂ÂÖ®Â±è</button>
                        <h3 style="margin-top:20px">üíÖ CSS</h3>
                        <textarea id="custom-css" placeholder="Ëá™ÂÆö‰πâ CSS..."></textarea>
                        <button id="apply-css">Â∫îÁî®</button>
                        <h3 style="margin-top:20px">üì¶ Â•óË£Ö</h3>
                        <button id="export-theme">ÂØºÂá∫</button>
                        <button id="import-theme">ÂØºÂÖ•</button>
                        
                        <h3 style="margin-top:20px;color:#d9534f">üßπ Ê∏ÖÈô§Êï∞ÊçÆ</h3>
                        <button id="clear-beauty-data" style="width:100%;background:linear-gradient(135deg,#dc3545,#c82333)">Ê∏ÖÈô§ÂÖ®Â±ÄÁæéÂåñÊï∞ÊçÆ</button>
                    </div>
                </div>
            </div>

            <div id="home-screen">
                <div id="home-pages">
                    <div class="home-page active">
                        <!-- Êó∂Èó¥ÁªÑ‰ª∂ - È°∂ÈÉ®‰∏≠Â§Æ -->
                        <div id="time-widget" class="widget">
                            <div id="current-time"></div>
                            <input type="text" id="current-date" placeholder="Ê¨¢Ëøé‰ΩøÁî®Â∞èÁôΩÊú∫" style="border:none;background:transparent;text-align:center;outline:none;cursor:text;font-size:12px;width:100%;color:#333">
                        </div>
                        
                        <!-- Êó•ÂéÜÁªÑ‰ª∂ - Âè≥‰∏äËßí -->
                        <div id="calendar-widget" class="widget"></div>
                        
                        <!-- ‰ªªÂä°Ê†è - Â∑¶‰∏ãËßí -->
                        <textarea id="today-memo-widget" placeholder="‰ªäÂ§©Ê≤°Êúâ‰ªªÂä°" rows="1"></textarea>

                        <!-- Â∫îÁî®ÂõæÊ†á - ÂØπËßíÁ∫øÊéíÂàó -->
                        <div class="app-icon app-icon-1" data-app="linee">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 44 44'%3E%3Crect width='44' height='44' rx='10' fill='%23A0D8EF'/%3E%3Ctext x='22' y='28' font-size='24' text-anchor='middle' fill='white'%3EL%3C/text%3E%3C/svg%3E">
                            <span>Linee</span>
                        </div>
                        <div class="app-icon app-icon-2" data-app="worldbook">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 44 44'%3E%3Crect width='44' height='44' rx='10' fill='%234A90E2'/%3E%3Ctext x='22' y='28' font-size='24' text-anchor='middle' fill='white'%3Eüåç%3C/text%3E%3C/svg%3E">
                            <span>‰∏ñÁïå‰π¶</span>
                        </div>
                        <div class="app-icon app-icon-3" data-app="developing">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 44 44'%3E%3Crect width='44' height='44' rx='10' fill='%23FF2442'/%3E%3Ctext x='22' y='28' font-size='24' text-anchor='middle' fill='white'%3EÂ∞è%3C/text%3E%3C/svg%3E">
                            <span>Â∞èÁ∫¢‰π¶</span>
                        </div>
                        <div class="app-icon app-icon-4" data-app="developing">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 44 44'%3E%3Crect width='44' height='44' rx='10' fill='%2307C160'/%3E%3Ctext x='22' y='28' font-size='24' text-anchor='middle' fill='white'%3EIM%3C/text%3E%3C/svg%3E">
                            <span>IM</span>
                        </div>
                    </div>
                    <div class="home-page">
                        <!-- Èü≥‰πêÁªÑ‰ª∂ - Á¨¨‰∫åÈ°µÊúÄ‰∏äÊñπ -->
                        <div id="music-widget" class="widget music-full">
                            <div class="music-cover-art">
                                <div class="music-vinyl">üéµ</div>
                            </div>
                            <div class="music-info">
                                <div class="music-title">Êú™Êí≠Êîæ</div>
                                <div class="music-artist">Ê∑ªÂä†Èü≥‰πêÂºÄÂßãÊí≠Êîæ</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>
                            </div>
                            <div class="music-controls">
                                <button id="music-prev" class="control-btn">‚èÆ</button>
                                <button id="music-play" class="control-btn play-btn">‚ñ∂</button>
                                <button id="music-next" class="control-btn">‚è≠</button>
                            </div>
                            <div class="music-actions">
                                <button id="music-search" class="action-btn" title="ÊêúÁ¥¢Èü≥‰πê">üîç</button>
                                <button id="music-add" class="action-btn" title="Ê∑ªÂä†Èü≥‰πê">‚ûï</button>
                                <button id="music-list" class="action-btn" title="ÊàëÁöÑÊ≠åÂçï">‚ò∞</button>
                            </div>
                        </div>
                        <div class="app-grid">
                            <div class="app-icon developing">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 44 44'%3E%3Crect width='44' height='44' rx='10' fill='%23999'/%3E%3Ctext x='22' y='28' font-size='16' text-anchor='middle' fill='white'%3EÂºÄÂèë‰∏≠%3C/text%3E%3C/svg%3E">
                                <span>ÂºÄÂèë‰∏≠</span>
                            </div>
                            <div class="app-icon developing">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 44 44'%3E%3Crect width='44' height='44' rx='10' fill='%23999'/%3E%3Ctext x='22' y='28' font-size='16' text-anchor='middle' fill='white'%3EÂºÄÂèë‰∏≠%3C/text%3E%3C/svg%3E">
                                <span>ÂºÄÂèë‰∏≠</span>
                            </div>
                            <div class="app-icon developing">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 44 44'%3E%3Crect width='44' height='44' rx='10' fill='%23999'/%3E%3Ctext x='22' y='28' font-size='16' text-anchor='middle' fill='white'%3EÂºÄÂèë‰∏≠%3C/text%3E%3C/svg%3E">
                                <span>ÂºÄÂèë‰∏≠</span>
                            </div>
                            <div class="app-icon developing">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 44 44'%3E%3Crect width='44' height='44' rx='10' fill='%23999'/%3E%3Ctext x='22' y='28' font-size='16' text-anchor='middle' fill='white'%3EÂºÄÂèë‰∏≠%3C/text%3E%3C/svg%3E">
                                <span>ÂºÄÂèë‰∏≠</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="page-indicator">
                    <span class="dot active"></span>
                    <span class="dot"></span>
                </div>
            </div>

            <div id="linee-app" class="app-window hidden">
                <div id="linee-app-content">
                    <!-- Main Content - Home Tab -->
                    <div class="linee-main" id="linee-tab-home">
                        <!-- Linee Header -->
                        <div class="linee-header" style="margin-top: 32px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button class="linee-icon-btn" onclick="closeApp()"><ion-icon name="arrow-back-outline"></ion-icon></button>
                                <div class="linee-title">LINEE</div>
                            </div>
                            <div class="linee-actions">
                                <button class="linee-icon-btn" id="linee-btn-favorites"><ion-icon name="star-outline"></ion-icon></button>
                                <button class="linee-icon-btn" id="linee-btn-notifications"><ion-icon name="notifications-outline"></ion-icon></button>
                                <div style="position:relative;">
                                    <button class="linee-icon-btn" id="linee-btn-add"><ion-icon name="person-add-outline"></ion-icon></button>
                                    <div class="linee-popover hidden" id="linee-add-popover">
                                        <div class="linee-popover-item" id="linee-opt-add-friend">
                                            <ion-icon name="person-outline"></ion-icon> Âä†ÂÖ•Â•ΩÂèã
                                        </div>
                                        <div class="linee-popover-item" id="linee-opt-add-group">
                                            <ion-icon name="people-outline"></ion-icon> Âª∫Á´ãÁæ§ÁªÑ
                                        </div>
                                    </div>
                                </div>
                                <button class="linee-icon-btn" id="linee-btn-settings"><ion-icon name="settings-outline"></ion-icon></button>
                            </div>
                        </div>
                        <!-- Profile Section -->
                        <div class="linee-profile">
                            <div class="linee-profile-row" id="linee-profile-clickable" style="cursor:pointer;">
                                <div class="linee-profile-info">
                                    <div class="linee-name" id="linee-display-name">ÊàëÁöÑÂêçÂ≠ó</div>
                                    <div class="linee-status" id="linee-display-status">ËÆæÂÆöÁä∂ÊÄÅÊ∂àÊÅØ...</div>
                                </div>
                                <div class="linee-avatar">
                                    <img id="linee-display-avatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Avatar">
                                    <div class="linee-edit-badge">‚úèÔ∏è</div>
                                </div>
                            </div>
                            
                            <!-- Persona Cards -->
                            <div class="linee-cards">
                                <div class="linee-card active">Êó•Â∏∏</div>
                                <div class="linee-card">Â∑•‰Ωú</div>
                                <div class="linee-card">‰ºëÈó≤</div>
                            </div>
                        </div>

                        <!-- Search Bar -->
                        <div class="linee-search-section">
                            <div class="linee-search">
                                <ion-icon name="search-outline" class="linee-search-icon"></ion-icon>
                                <input type="text" placeholder="ÊêúÁ¥¢Â•ΩÂèã„ÄÅÁæ§ÁªÑ" id="linee-search-input">
                            </div>
                        </div>

                        <!-- Lists -->
                        <div class="linee-lists">
                            <!-- Birthdays -->
                            <div class="linee-list-group" id="linee-group-birthdays">
                                <div class="linee-list-header">
                                    <div class="linee-header-text">
                                        <span class="linee-list-title">ÂΩìÊúàÂØøÊòü</span>
                                    </div>
                                    <ion-icon name="chevron-forward-outline" class="linee-arrow"></ion-icon>
                                </div>
                                <div class="linee-list-content hidden" id="linee-birthdays-list">
                                    <!-- Dynamic Birthday Friends -->
                                </div>
                            </div>

                            <!-- Favorites -->
                            <div class="linee-list-group" id="linee-group-favorites">
                                <div class="linee-list-header">
                                    <div class="linee-header-text">
                                        <span class="linee-list-title">ÊàëÁöÑÊúÄÁà±</span>
                                    </div>
                                    <ion-icon name="chevron-forward-outline" class="linee-arrow"></ion-icon>
                                </div>
                                <div class="linee-list-content hidden" id="linee-favorites-list">
                                    <!-- Dynamic Favorite Friends -->
                                </div>
                            </div>

                            <!-- Friends -->
                            <div class="linee-list-group expanded" id="linee-group-friends">
                                <div class="linee-list-header" onclick="toggleLineeList('linee-friends-list', this)">
                                    <div class="linee-header-text">
                                        <span class="linee-list-title">Â•ΩÂèã</span>
                                        <span class="linee-list-count" id="linee-friend-count">(5)</span>
                                    </div>
                                    <ion-icon name="chevron-forward-outline" class="linee-arrow"></ion-icon>
                                </div>
                                <div class="linee-list-content" id="linee-friends-list">
                                    <!-- Dynamic Friend Items -->
                                </div>
                            </div>

                            <!-- Groups -->
                            <div class="linee-list-group" id="linee-group-groups">
                                <div class="linee-list-header" onclick="toggleLineeList('linee-groups-list', this)">
                                    <div class="linee-header-text">
                                        <span class="linee-list-title">Áæ§ÁªÑ</span>
                                        <span class="linee-list-count" id="linee-group-count">(2)</span>
                                    </div>
                                    <ion-icon name="chevron-forward-outline" class="linee-arrow"></ion-icon>
                                </div>
                                <div class="linee-list-content hidden" id="linee-groups-list">
                                    <!-- Dynamic Group Items -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content - Chats Tab -->
                    <div class="linee-main" id="linee-tab-chats" style="display: none; padding: 0;">
                        <!-- Chat Header -->
                        <div class="linee-header" style="margin-top: 32px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button class="linee-icon-btn" onclick="document.querySelectorAll('.linee-nav-item')[0].click()"><ion-icon name="arrow-back-outline"></ion-icon></button>
                                <div class="linee-title">ËÅäÂ§©</div>
                            </div>
                            <div class="linee-actions">
                                <button class="linee-icon-btn"><ion-icon name="image-outline"></ion-icon></button>
                                <button class="linee-icon-btn"><ion-icon name="add-circle-outline"></ion-icon></button>
                                <button class="linee-icon-btn"><ion-icon name="ellipsis-vertical"></ion-icon></button>
                            </div>
                        </div>
                        <!-- Search Bar -->
                        <div style="padding: 12px 16px; background: #FFFFFF;">
                            <div style="position: relative;">
                                <ion-icon name="search-outline" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 16px; color: #9CA3AF;"></ion-icon>
                                <input type="text" placeholder="ÊêúÂØªËÅäÂ§©ËÆ∞ÂΩï" style="width: 100%; padding: 8px 12px 8px 36px; border: none; border-radius: 12px; background: #E8F6FA; font-size: 14px; outline: none;" />
                            </div>
                        </div>
                        <!-- Chat List -->
                        <div id="linee-chat-list" style="overflow-y: auto; padding-bottom: 80px;"></div>
                    </div>

                    <!-- Chat Room -->
                    <div id="linee-chat-room" style="display: none; flex-direction: column; height: 100%; position: relative; z-index: 50;">
                        <!-- Chat Room Header -->
                        <div class="linee-header" style="margin-top: 32px; height: 56px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button class="linee-icon-btn" onclick="closeChatRoom()"><ion-icon name="arrow-back-outline"></ion-icon></button>
                                <div class="linee-title" id="chat-room-name" style="max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></div>
                            </div>
                            <div class="linee-actions">
                                <button class="linee-icon-btn"><ion-icon name="search-outline"></ion-icon></button>
                                <button class="linee-icon-btn"><ion-icon name="call-outline"></ion-icon></button>
                                <button class="linee-icon-btn" onclick="openChatSettings()"><ion-icon name="ellipsis-vertical"></ion-icon></button>
                            </div>
                        </div>
                        <!-- Messages -->
                        <div id="chat-messages-container" style="flex: 1; overflow-y: auto; padding: 16px; background: #FFFFFF;"></div>
                        <!-- Input Area -->
                        <div style="border-top: 1px solid #F5F5F5; background: #FFFFFF;">
                            <!-- Toolbar -->
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px; min-height: 56px;">
                                <!-- Left Actions -->
                                <div style="display: flex; align-items: center; gap: 4px; flex-shrink: 0;">
                                    <button class="linee-icon-btn" onclick="togglePlusMenu()" id="plus-menu-btn"><ion-icon name="add-outline"></ion-icon></button>
                                    <button class="linee-icon-btn" onclick="promptImageMessage()"><ion-icon name="image-outline"></ion-icon></button>
                                    <button class="linee-icon-btn" onclick="promptAudioMessage()"><ion-icon name="mic-outline"></ion-icon></button>
                                </div>
                                <!-- Center Input -->
                                <div style="flex: 1; position: relative; display: flex; align-items: center;">
                                    <input type="text" id="chat-input-field" placeholder="ËæìÂÖ•ËÆØÊÅØ..." onkeydown="if(event.key==='Enter') sendChatMessage()" style="width: 100%; background: #F3F4F6; border-radius: 20px; padding: 10px 40px 10px 16px; font-size: 14px; color: #333; border: none; outline: none;" />
                                    <button onclick="sendChatMessage()" style="position: absolute; right: 6px; padding: 6px; background: #A0D8EF; color: #FFFFFF; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;"><ion-icon name="send" style="font-size: 16px; margin-left: 2px; margin-top: 2px;"></ion-icon></button>
                                </div>
                                <!-- Right Actions -->
                                <div style="display: flex; align-items: center; gap: 4px; flex-shrink: 0;">
                                    <button class="linee-icon-btn" onclick="handleAIRead()" style="color: #F59E0B;"><ion-icon name="bulb-outline"></ion-icon></button>
                                    <button class="linee-icon-btn"><ion-icon name="happy-outline"></ion-icon></button>
                                </div>
                            </div>
                            <!-- Plus Menu -->
                            <div id="plus-menu" style="display: none; grid-template-columns: repeat(4, 1fr); gap: 16px; padding: 16px; background: #F9FAFB; border-top: 1px solid #F5F5F5;">
                                <button onclick="alert('ÈÄÅÁ§ºÁâ©')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 8px; background: none; border: none; cursor: pointer;">
                                    <div style="width: 48px; height: 48px; background: #FFFFFF; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); color: #A0D8EF;"><ion-icon name="gift-outline" style="font-size: 24px;"></ion-icon></div>
                                    <span style="font-size: 11px; color: #6B7280;">ÈÄÅÁ§ºÁâ©</span>
                                </button>
                                <button onclick="alert('ËΩ¨Â∏ê')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 8px; background: none; border: none; cursor: pointer;">
                                    <div style="width: 48px; height: 48px; background: #FFFFFF; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); color: #A0D8EF;"><ion-icon name="swap-horizontal-outline" style="font-size: 24px;"></ion-icon></div>
                                    <span style="font-size: 11px; color: #6B7280;">ËΩ¨Â∏ê</span>
                                </button>
                                <button onclick="alert('ÊåëÊó•Â≠ê')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 8px; background: none; border: none; cursor: pointer;">
                                    <div style="width: 48px; height: 48px; background: #FFFFFF; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); color: #A0D8EF;"><ion-icon name="calendar-outline" style="font-size: 24px;"></ion-icon></div>
                                    <span style="font-size: 11px; color: #6B7280;">ÊåëÊó•Â≠ê</span>
                                </button>
                                <button onclick="alert('ÂàÜ‰∫´‰ΩçÁΩÆ')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 8px; background: none; border: none; cursor: pointer;">
                                    <div style="width: 48px; height: 48px; background: #FFFFFF; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); color: #A0D8EF;"><ion-icon name="location-outline" style="font-size: 24px;"></ion-icon></div>
                                    <span style="font-size: 11px; color: #6B7280;">ÂàÜ‰∫´‰ΩçÁΩÆ</span>
                                </button>
                                <button onclick="alert('‰º†ÈÄÅËøûÁªì')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 8px; background: none; border: none; cursor: pointer;">
                                    <div style="width: 48px; height: 48px; background: #FFFFFF; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); color: #A0D8EF;"><ion-icon name="link-outline" style="font-size: 24px;"></ion-icon></div>
                                    <span style="font-size: 11px; color: #6B7280;">‰º†ÈÄÅËøûÁªì</span>
                                </button>
                            </div>
                        </div>
                        <!-- Prompt Modal -->
                        <div id="prompt-modal" style="display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.2); z-index: 60; align-items: center; justify-content: center; padding: 0 32px;">
                            <div style="background: #FFFFFF; border-radius: 16px; padding: 24px; width: 100%; box-shadow: 0 8px 24px rgba(0,0,0,0.15);">
                                <h3 id="prompt-title" style="font-size: 18px; font-weight: 700; color: #333; margin-bottom: 16px;"></h3>
                                <textarea id="prompt-input" rows="3" placeholder="" style="width: 100%; background: #F9FAFB; border-radius: 12px; padding: 12px; color: #333; font-size: 14px; border: none; outline: none; resize: none; margin-bottom: 16px;"></textarea>
                                <div style="display: flex; gap: 12px;">
                                    <button onclick="closePromptModal()" style="flex: 1; padding: 10px; border-radius: 12px; background: #F3F4F6; color: #6B7280; font-weight: 600; font-size: 14px; border: none; cursor: pointer;">ÂèñÊ∂à</button>
                                    <button onclick="submitPrompt()" style="flex: 1; padding: 10px; border-radius: 12px; background: #A0D8EF; color: #FFFFFF; font-weight: 600; font-size: 14px; border: none; cursor: pointer;">ÂèëÈÄÅ</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Nav -->
                    <div class="linee-nav">
                        <div class="linee-nav-item active" data-tab="home">
                            <ion-icon name="home-outline" class="linee-nav-icon"></ion-icon>
                            <span>‰∏ªÈ°µ</span>
                        </div>
                        <div class="linee-nav-item" data-tab="chats">
                            <ion-icon name="chatbubble-ellipses-outline" class="linee-nav-icon"></ion-icon>
                            <span>ËÅäÂ§©</span>
                        </div>
                        <div class="linee-nav-item" data-tab="steps">
                            <ion-icon name="footsteps-outline" class="linee-nav-icon"></ion-icon>
                            <span>Ë∂≥Ë∑°</span>
                        </div>
                        <div class="linee-nav-item" data-tab="diary" onclick="openDiaryApp()">
                            <ion-icon name="journal-outline" class="linee-nav-icon"></ion-icon>
                            <span>Êó•ËÆ∞</span>
                        </div>
                        <div class="linee-nav-item" data-tab="wallet">
                            <ion-icon name="wallet-outline" class="linee-nav-icon"></ion-icon>
                            <span>Èí±ÂåÖ</span>
                        </div>
                    </div>

                    <!-- Main Content - Steps Tab -->
                    <div class="linee-main" id="linee-tab-steps" style="display: none; padding: 0;">
                        <!-- Steps Home View -->
                        <div id="steps-home-view" style="display: flex; flex-direction: column; height: 100%; background: #FFFFFF;">
                            <!-- Header -->
                            <div style="padding: 0 12px; display: flex; justify-content: space-between; align-items: center; height: 60px; border-bottom: 1px solid #F5F5F5; margin-top: 32px;">
                                <h1 id="steps-header-title" style="font-size: 20px; font-weight: 800; color: #333; letter-spacing: -0.5px;">Ë∂≥Ëøπ</h1>
                                <div style="display: flex; gap: 12px;">
                                    <button id="steps-delete-btn" class="linee-icon-btn" style="color: #D1D5DB;" disabled><ion-icon name="trash-outline"></ion-icon></button>
                                    <button id="steps-add-btn" class="linee-icon-btn" style="background: rgba(160,216,239,0.1); color: #A0D8EF;"><ion-icon name="add" style="--ionicon-stroke-width: 60px;"></ion-icon></button>
                                </div>
                            </div>
                            <!-- World Cards Scroll -->
                            <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; padding-bottom: 80px;">
                                <div id="steps-worlds-container" style="overflow-x: auto; display: flex; align-items: center; padding: 0 24px; gap: 24px; scroll-snap-type: x mandatory; min-height: 440px;">
                                    <div style="width: 100%; text-align: center; color: #9CA3AF; padding: 40px 0;">ÊöÇÊó†‰∏ñÁïåËßÇÔºåÁÇπÂáªÂè≥‰∏äËßí + Êñ∞Â¢û</div>
                                </div>
                                <div id="steps-hint" style="text-align: center; color: #9CA3AF; font-size: 14px; margin-top: 16px;"></div>
                            </div>
                        </div>

                        <!-- World Create View -->
                        <div id="steps-create-view" style="display: none; flex-direction: column; height: 100%; background: #FFFFFF;">
                            <!-- Header -->
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0 12px; height: 60px; border-bottom: 1px solid #F5F5F5; background: #FFFFFF; margin-top: 32px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <button id="create-back-btn" class="linee-icon-btn"><ion-icon name="chevron-back-outline"></ion-icon></button>
                                    <div class="linee-title">Êñ∞Â¢û‰∏ñÁïåËßÇ</div>
                                </div>
                                <button id="create-save-btn" style="color: #A0D8EF; font-weight: 700; font-size: 14px; padding: 4px 8px; border-radius: 8px; background: none; border: none; cursor: pointer;" disabled>‰øùÂ≠ò</button>
                            </div>
                            <!-- Form -->
                            <div style="flex: 1; overflow-y: auto; padding: 24px 24px 80px; display: flex; flex-direction: column; gap: 24px;">
                                <div>
                                    <label style="font-size: 14px; font-weight: 600; color: #374151; display: block; margin-bottom: 8px;">‰∏ñÁïåËßÇÂêçÁß∞</label>
                                    <input id="create-name" type="text" placeholder="‰æãÂ¶ÇÔºöËµõÂçöÊúãÂÖã 2077" style="width: 100%; background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 12px; padding: 12px 16px; font-size: 14px; outline: none;" />
                                </div>
                                <div>
                                    <label style="font-size: 14px; font-weight: 600; color: #374151; display: block; margin-bottom: 8px;">‰∏ñÁïåËßÇÊèèËø∞</label>
                                    <textarea id="create-desc" placeholder="ÊèèËø∞Ëøô‰∏™‰∏ñÁïåÁöÑËÉåÊôØ„ÄÅÊ∞õÂõ¥..." style="width: 100%; background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 12px; padding: 12px 16px; font-size: 14px; outline: none; min-height: 100px; resize: none;"></textarea>
                                </div>
                                <div>
                                    <label style="font-size: 14px; font-weight: 600; color: #374151; display: block; margin-bottom: 8px;">ÂøÖË¶ÅÂú∞Ê†á (Áî®ÈÄóÂè∑ÂàÜÈöî)</label>
                                    <div style="position: relative;">
                                        <ion-icon name="location-outline" style="position: absolute; left: 12px; top: 14px; font-size: 18px; color: #9CA3AF;"></ion-icon>
                                        <input id="create-landmarks" type="text" placeholder="‰æãÂ¶ÇÔºö‰∏≠Â§ÆÂ°î, Ë¥´Ê∞ëÁ™ü, ËçíÂùÇÂ°î..." style="width: 100%; background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 12px; padding: 12px 16px 12px 40px; font-size: 14px; outline: none;" />
                                    </div>
                                </div>
                                <div>
                                    <label style="font-size: 14px; font-weight: 600; color: #374151; display: block; margin-bottom: 8px;">Âú∞ÂõæÈ¢ÑËßà</label>
                                    <div id="create-map-preview" style="width: 100%; aspect-ratio: 1; background: #F3F4F6; border-radius: 16px; border: 2px dashed #D1D5DB; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; position: relative;">
                                        <p style="color: #9CA3AF; font-size: 14px; margin-bottom: 16px;">Â°´ÂÜôÂÆåÊØïÂêéÁÇπÂáªÁîüÊàê</p>
                                        <button id="create-generate-btn" style="background: #A0D8EF; color: #FFFFFF; padding: 10px 24px; border-radius: 24px; font-weight: 600; box-shadow: 0 2px 8px rgba(160,216,239,0.3); border: none; cursor: pointer; display: flex; align-items: center; gap: 8px;"><ion-icon name="refresh-outline"></ion-icon><span>ÁîüÊàêÂú∞Âõæ</span></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Character List View -->
                        <div id="steps-charlist-view" style="display: none; flex-direction: column; height: 100%; background: #FFFFFF;">
                            <!-- Header -->
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0 12px; height: 60px; border-bottom: 1px solid #F5F5F5; background: #FFFFFF; margin-top: 32px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <button id="charlist-back-btn" class="linee-icon-btn"><ion-icon name="chevron-back-outline"></ion-icon></button>
                                    <div>
                                        <div class="linee-title" id="charlist-world-name" style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></div>
                                        <p style="font-size: 10px; color: #9CA3AF;">ËßíËâ≤ÂàóË°®</p>
                                    </div>
                                </div>
                                <div style="position: relative;">
                                    <button id="charlist-menu-btn" class="linee-icon-btn"><ion-icon name="ellipsis-vertical"></ion-icon></button>
                                    <div id="charlist-menu" class="linee-popover hidden" style="right: 0; top: 50px; width: 160px;">
                                        <div class="linee-popover-item" onclick="openAddCharModal()"><ion-icon name="person-add-outline"></ion-icon> Êñ∞Â¢ûËßíËâ≤</div>
                                        <div class="linee-popover-item" onclick="toggleCharDeleteMode()"><ion-icon name="trash-outline"></ion-icon> Âà†Èô§ËßíËâ≤</div>
                                        <div style="height: 1px; background: #F5F5F5; margin: 4px 0;"></div>
                                        <div class="linee-popover-item" onclick="openMapRefreshModal()"><ion-icon name="map-outline"></ion-icon> Âú∞ÂõæÂà∑Êñ∞</div>
                                        <div class="linee-popover-item" onclick="openFootprintSettingsModal()"><ion-icon name="settings-outline"></ion-icon> Ë∂≥ËøπËÆæÂÆö</div>
                                    </div>
                                </div>
                            </div>
                            <!-- Character Grid -->
                            <div style="flex: 1; overflow-y: auto; padding: 16px;">
                                <div id="charlist-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;"></div>
                            </div>
                        </div>

                        <!-- Character Detail View -->
                        <div id="steps-chardetail-view" style="display: none; flex-direction: column; height: 100%; background: #FFFFFF;">
                            <!-- Header (Overlay) -->
                            <div style="position: absolute; top: 32px; left: 0; right: 0; height: 60px; z-index: 20; display: flex; align-items: center; padding: 0 12px; background: linear-gradient(to bottom, rgba(0,0,0,0.4), transparent);">
                                <button id="chardetail-back-btn" class="linee-icon-btn" style="color: #FFFFFF;"><ion-icon name="chevron-back-outline"></ion-icon></button>
                                <span id="chardetail-char-name" class="linee-title" style="color: #FFFFFF; margin-left: 8px; text-shadow: 0 1px 3px rgba(0,0,0,0.3);"></span>
                            </div>
                            <!-- Map Section -->
                            <div id="chardetail-map" style="height: 45%; position: relative; background: #E5E7EB;"></div>
                            <!-- Timeline Section -->
                            <div style="flex: 1; background: #FFFFFF; margin-top: -16px; border-radius: 24px 24px 0 0; position: relative; z-index: 10; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden;">
                                <div style="width: 48px; height: 4px; background: #E5E7EB; border-radius: 2px; margin: 12px auto 8px; flex-shrink: 0;"></div>
                                <div id="chardetail-timeline" style="flex: 1; overflow-y: auto; padding: 0 24px 40px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Steps Modals -->
                    <div id="steps-modal-add-char" class="linee-modal hidden">
                        <div class="linee-modal-content" style="max-height: 70vh; overflow-y: auto;">
                            <h3>‰ªé LINEE Â•ΩÂèã‰∏≠ÈÄâÊã©</h3>
                            <div id="steps-friend-list" style="max-height: 300px; overflow-y: auto; margin: 16px 0;"></div>
                            <div class="linee-modal-actions">
                                <button class="linee-btn-cancel" onclick="closeStepsModal('steps-modal-add-char')">ÂèñÊ∂à</button>
                            </div>
                        </div>
                    </div>

                    <div id="steps-modal-map-refresh" class="linee-modal hidden">
                        <div class="linee-modal-content">
                            <h3>Âú∞ÂõæÂà∑Êñ∞</h3>
                            <p style="font-size: 12px; color: #6B7280; background: #FEF3C7; padding: 8px; border-radius: 8px; margin-bottom: 12px;">‚ö† Ëã•Â∑≤ÁîüÊàê‰ªäÊó•Ë∂≥ËøπÔºåÂà∑Êñ∞Âú∞ÂõæÂ∞Ü‰øùÁïôÊó¢ÊúâËßíËâ≤ÂùêÊ†á</p>
                            <div style="position: relative; margin-bottom: 12px;">
                                <ion-icon name="search-outline" style="position: absolute; left: 12px; top: 12px; font-size: 14px; color: #9CA3AF;"></ion-icon>
                                <input id="map-refresh-keyword" type="text" placeholder="ËæìÂÖ•ÂÖ≥ÈîÆËØçÔºà‰æãÂ¶ÇÔºöÂåóÊñπÊ£ÆÊûóÔºâ..." style="width: 100%; padding: 10px 12px 10px 36px; border: 1px solid #E5E7EB; border-radius: 10px; font-size: 13px; outline: none;" />
                            </div>
                            <div id="map-refresh-preview" style="width: 100%; aspect-ratio: 16/9; background: #F3F4F6; border-radius: 12px; margin-bottom: 12px; overflow: hidden; position: relative;">
                                <div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: #9CA3AF; font-size: 12px;">ÁÇπÂáªÂà∑Êñ∞ÊåâÈíÆÈ¢ÑËßà</div>
                            </div>
                            <div id="map-refresh-changelog" style="display: none; background: #F9FAFB; padding: 12px; border-radius: 10px; margin-bottom: 12px; font-size: 12px; color: #374151; line-height: 1.6;"></div>
                            <div class="linee-modal-actions">
                                <button class="linee-btn-cancel" onclick="closeStepsModal('steps-modal-map-refresh')">ÂèñÊ∂à</button>
                                <button id="map-refresh-btn" class="linee-btn-confirm" onclick="executeMapRefresh()">Âà∑Êñ∞</button>
                            </div>
                        </div>
                    </div>

                    <div id="steps-modal-footprint-settings" class="linee-modal hidden">
                        <div class="linee-modal-content" style="max-height: 70vh; overflow-y: auto;">
                            <h3>Ë∂≥ËøπËÆæÂÆö</h3>
                            <button onclick="generateAllFootprints()" style="width: 100%; background: linear-gradient(135deg, #A0D8EF, #8FCCE5); color: #FFFFFF; padding: 14px; border-radius: 12px; font-weight: 700; border: none; cursor: pointer; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; gap: 8px;"><ion-icon name="flash-outline"></ion-icon>‰∏ÄÈîÆÁîüÊàêÂÖ®ÂëòË∂≥Ëøπ</button>
                            <p style="font-size: 11px; text-align: center; color: #9CA3AF; margin-bottom: 16px;">Á≥ªÁªüÂ∞ÜËá™Âä®ÊºîÁÆó‰ªäÊó•ÊâÄÊúâËßíËâ≤ÁöÑ‰∫íÂä®‰∏éË∑ØÂæÑ</p>
                            <div style="height: 1px; background: #E5E7EB; margin: 16px 0;"></div>
                            <h4 style="font-size: 14px; font-weight: 700; color: #374151; margin-bottom: 12px;">Âçï‰∫∫ÁîüÊàêËÆæÂÆö</h4>
                            <div id="footprint-char-list" style="display: flex; flex-direction: column; gap: 8px;"></div>
                            <div class="linee-modal-actions" style="margin-top: 16px;">
                                <button class="linee-btn-cancel" onclick="closeStepsModal('steps-modal-footprint-settings')">ÂÖ≥Èó≠</button>
                            </div>
                        </div>
                    </div>

                    <!-- Modals -->
                    <div id="linee-modal-add-friend" class="linee-modal hidden" style="z-index: 200;">
                        <div class="linee-modal-content" style="max-width: 360px;">
                            <h3 style="margin-bottom: 8px;">Ê∑ªÂä†Êñ∞ËÅîÁ≥ª‰∫∫</h3>
                            <p style="font-size: 12px; color: #999; margin-bottom: 20px;">ÈÄâÊã©ÂàõÂª∫ÊñπÂºè</p>
                            
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <!-- Manual Create Character - Linear Style -->
                                <div style="border: 2px solid #E5E7EB; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 14px;" 
                                     onclick="document.getElementById('linee-modal-add-friend').classList.add('hidden'); document.getElementById('linee-modal-create-char').classList.remove('hidden');"
                                     onmouseover="this.style.borderColor='#A0D8EF'; this.style.background='#F9FAFB';"
                                     onmouseout="this.style.borderColor='#E5E7EB'; this.style.background='white';">
                                    <div style="width: 48px; height: 48px; border: 2px solid #A0D8EF; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#A0D8EF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; color: #111827; margin-bottom: 2px;">ÊâãÂä®ÂàõÂª∫</div>
                                        <div style="font-size: 12px; color: #9CA3AF;">Ëá™ÂÆö‰πâËßíËâ≤ËØ¶ÁªÜËÆæÂÆö</div>
                                    </div>
                                </div>
                                
                                <!-- AI Generate Character - Linear Style -->
                                <div style="border: 2px solid #E5E7EB; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 14px;" 
                                     onclick="document.getElementById('linee-modal-add-friend').classList.add('hidden'); document.getElementById('linee-modal-ai-generate').classList.remove('hidden');"
                                     onmouseover="this.style.borderColor='#A0D8EF'; this.style.background='#F9FAFB';"
                                     onmouseout="this.style.borderColor='#E5E7EB'; this.style.background='white';">
                                    <div style="width: 48px; height: 48px; border: 2px solid #A0D8EF; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#A0D8EF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                            <path d="M2 17l10 5 10-5"></path>
                                            <path d="M2 12l10 5 10-5"></path>
                                        </svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; color: #111827; margin-bottom: 2px;">AI ÁîüÊàê</div>
                                        <div style="font-size: 12px; color: #9CA3AF;">ËæìÂÖ•ÂÖ≥ÈîÆËØçËá™Âä®ÁîüÊàê</div>
                                    </div>
                                </div>
                                
                                <!-- Import Card - Linear Style -->
                                <div style="border: 2px solid #E5E7EB; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 14px;" 
                                     onclick="openImportCardModal(); document.getElementById('linee-modal-add-friend').classList.add('hidden');"
                                     onmouseover="this.style.borderColor='#A0D8EF'; this.style.background='#F9FAFB';"
                                     onmouseout="this.style.borderColor='#E5E7EB'; this.style.background='white';">
                                    <div style="width: 48px; height: 48px; border: 2px solid #A0D8EF; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#A0D8EF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="7 10 12 15 17 10"></polyline>
                                            <line x1="12" y1="15" x2="12" y2="3"></line>
                                        </svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; color: #111827; margin-bottom: 2px;">ÂØºÂÖ•ËßíËâ≤Âç°</div>
                                        <div style="font-size: 12px; color: #9CA3AF;">‰ªé Tavern Âç°ÂØºÂÖ•</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="linee-modal-actions" style="margin-top: 20px;">
                                <button class="linee-btn-cancel" onclick="closeLineeModal('linee-modal-add-friend')">ÂèñÊ∂à</button>
                            </div>
                        </div>
                    </div>

                    <!-- AI Generate Character Modal -->
                    <div id="linee-modal-ai-generate" class="linee-modal hidden" style="z-index: 300;">
                        <div class="linee-modal-content" style="max-width: 400px;">
                            <h3 style="margin-bottom: 8px;">‚ú® AI ÁîüÊàêËßíËâ≤</h3>
                            <p style="font-size: 12px; color: #999; margin-bottom: 16px;">ËæìÂÖ•ÂÖ≥ÈîÆËØçÔºåAI Â∞ÜËá™Âä®ÁîüÊàêÂÆåÊï¥ÁöÑËßíËâ≤ËÆæÂÆö</p>
                            
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">ÂÖ≥ÈîÆËØç</label>
                                <textarea id="ai-generate-keywords" placeholder="‰æãÂ¶ÇÔºöÂÜ∑ÈÖ∑Èú∏ÈÅìÊÄªË£Å„ÄÅÊ∏©ÊüîÈÇªÂÆ∂ÂßêÂßê„ÄÅ‰∏≠‰∫åÁóÖÈ≠îÊ≥ïÂ∏à..." rows="3" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; resize: vertical; font-size: 14px; line-height: 1.6;"></textarea>
                                <div style="font-size: 11px; color: #9CA3AF; margin-top: 6px;">üí° ÊèêÁ§∫ÔºöÂèØ‰ª•ÂåÖÂê´ÊÄßÂà´„ÄÅÂπ¥ÈæÑ„ÄÅËÅå‰∏ö„ÄÅÊÄßÊ†ºÁ≠â‰ø°ÊÅØ</div>
                            </div>
                            
                            <div style="background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                                <div style="font-size: 12px; color: #6B7280; margin-bottom: 8px;">
                                    <strong style="color: #374151;">Á§∫‰æãÔºö</strong>
                                </div>
                                <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                                    <span onclick="document.getElementById('ai-generate-keywords').value='28Â≤ÅÈú∏ÈÅìÊÄªË£ÅÔºåÂÜ∑Êº†È´òÂÇ≤ÔºåÂØπ‰∏ªËßíÊúâÊâßÂøµ'" style="font-size: 11px; padding: 4px 8px; background: white; border: 1px solid #D1D5DB; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#A0D8EF'; this.style.color='#0EA5E9';" onmouseout="this.style.borderColor='#D1D5DB'; this.style.color='inherit';">Èú∏ÈÅìÊÄªË£Å</span>
                                    <span onclick="document.getElementById('ai-generate-keywords').value='Ê∏©Êüî‰ΩìË¥¥ÁöÑÈÇªÂÆ∂ÂßêÂßêÔºå25Â≤ÅÔºåÂºÄÊúóÂñÑËâØ'" style="font-size: 11px; padding: 4px 8px; background: white; border: 1px solid #D1D5DB; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#A0D8EF'; this.style.color='#0EA5E9';" onmouseout="this.style.borderColor='#D1D5DB'; this.style.color='inherit';">ÈÇªÂÆ∂ÂßêÂßê</span>
                                    <span onclick="document.getElementById('ai-generate-keywords').value='‰∏≠‰∫åÁóÖÈ≠îÊ≥ïÂ∏àÔºå16Â≤ÅÔºåËá™Áß∞È≠îÁéãÔºåÂÆûÈôÖ‰∏äÂæàÂçïÁ∫Ø'" style="font-size: 11px; padding: 4px 8px; background: white; border: 1px solid #D1D5DB; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#A0D8EF'; this.style.color='#0EA5E9';" onmouseout="this.style.borderColor='#D1D5DB'; this.style.color='inherit';">‰∏≠‰∫åÈ≠îÊ≥ïÂ∏à</span>
                                    <span onclick="document.getElementById('ai-generate-keywords').value='ÂÜ∑ÈÖ∑ÊùÄÊâãÔºå32Â≤ÅÔºåÂØ°Ë®ÄÂ∞ëËØ≠ÔºåÂÜÖÂøÉÊüîËΩØ'" style="font-size: 11px; padding: 4px 8px; background: white; border: 1px solid #D1D5DB; border-radius: 6px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#A0D8EF'; this.style.color='#0EA5E9';" onmouseout="this.style.borderColor='#D1D5DB'; this.style.color='inherit';">ÂÜ∑ÈÖ∑ÊùÄÊâã</span>
                                </div>
                            </div>
                            
                            <div class="linee-modal-actions">
                                <button class="linee-btn-cancel" onclick="closeLineeModal('linee-modal-ai-generate')">ÂèñÊ∂à</button>
                                <button class="linee-btn-confirm" onclick="confirmAIGenerateChar()">
                                    <span>ü§ñ ÁîüÊàêËßíËâ≤</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="linee-modal-add-group" class="linee-modal hidden">
                        <div class="linee-modal-content">
                            <h3>Âª∫Á´ãÁæ§ÁªÑ</h3>
                            <div class="linee-avatar-upload">
                                <div class="linee-circle-preview">G</div>
                                <span class="linee-upload-hint">Êõ¥Êç¢Â§¥ÂÉè</span>
                            </div>
                            <input type="text" id="linee-new-group-name" placeholder="Áæ§ÁªÑÂêçÁß∞">
                            <div class="linee-checkbox-container">
                                <input type="checkbox" id="linee-check-join" checked>
                                <span>Êàë‰πüÂä†ÂÖ•Ê≠§Áæ§ÁªÑ</span>
                            </div>
                            <div class="linee-modal-actions">
                                <button class="linee-btn-cancel" onclick="closeLineeModal('linee-modal-add-group')">ÂèñÊ∂à</button>
                                <button class="linee-btn-confirm" onclick="confirmLineeAddGroup()">Âª∫Á´ã</button>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Create Character Modal -->
                    <div id="linee-modal-create-char" class="linee-modal hidden" style="z-index: 200;">
                        <div class="linee-modal-content" style="max-height: 85vh; overflow-y: auto; width: 90%; max-width: 400px;">
                            <h3>‚ú® È´òÁ∫ßËßíËâ≤ÂàõÂª∫</h3>
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <input type="text" id="ai-char-name" placeholder="ÂßìÂêç (ÂøÖÂ°´)" style="padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                                <div style="display: flex; gap: 10px;">
                                    <select id="ai-char-gender" style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                                        <option value="Áî∑">Áî∑</option>
                                        <option value="Â•≥">Â•≥</option>
                                        <option value="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ</option>
                                    </select>
                                    <input type="text" id="ai-char-identity" placeholder="Ë∫´‰ªΩ/ËÅå‰∏ö" style="flex: 2; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                                </div>
                                <textarea id="ai-char-appearance" placeholder="Â§ñË≤åÁâπÂæÅ..." rows="2" style="padding: 10px; border: 1px solid #ddd; border-radius: 8px; resize: none;"></textarea>
                                <textarea id="ai-char-background" placeholder="Ê†∏ÂøÉËÉåÊôØ‰∏éÊÄßÊ†ºËÆæÂÆö (Ë∂äËØ¶ÁªÜË∂äÂ•Ω)..." rows="4" style="padding: 10px; border: 1px solid #ddd; border-radius: 8px; resize: none;"></textarea>
                                
                                <div>
                                    <label style="font-size: 12px; color: #666;">ÊÄßÊ†ºÊ†áÁ≠æ (Áî®ÈÄóÂè∑ÂàÜÈöî)</label>
                                    <input type="text" id="ai-char-tags" placeholder="‰æãÂ¶Ç: ÂÇ≤Â®á, È´òÂÜ∑" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                                </div>
                                
                                <div>
                                    <label style="font-size: 12px; color: #666;">ÂØπËØùÈ£éÊ†º</label>
                                    <select id="ai-char-style" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                                        <option value="Áé∞‰ª£Êó•Â∏∏ (ÈªòËÆ§)">Áé∞‰ª£Êó•Â∏∏ (ÈªòËÆ§)</option>
                                        <option value="Âè§È£é (Âêæ, Ê±ù, ÁîöÂ•Ω)">Âè§È£é</option>
                                        <option value="ÁøªËØëËÖî (Âì¶, ÊàëÁöÑËÄÅ‰ºôËÆ°)">ÁøªËØëËÖî</option>
                                        <option value="‰∫åÊ¨°ÂÖÉ (È¢úÊñáÂ≠ó)">‰∫åÊ¨°ÂÖÉ</option>
                                        <option value="ËµõÂçöÊúãÂÖã">ËµõÂçöÊúãÂÖã</option>
                                    </select>
                                </div>

                                <textarea id="ai-char-first-msg" placeholder="ÂºÄÂú∫ÁôΩ (ÈÄâÂ°´)..." rows="2" style="padding: 10px; border: 1px solid #ddd; border-radius: 8px; resize: none;"></textarea>
                            </div>
                            <div class="linee-modal-actions" style="margin-top: 20px;">
                                <button class="linee-btn-cancel" onclick="closeLineeModal('linee-modal-create-char')">ÂèñÊ∂à</button>
                                <button class="linee-btn-confirm" onclick="confirmAICreateChar()">ÂàõÂª∫</button>
                            </div>
                        </div>
                    </div>

                    <!-- World Book Modal -->
                    <div id="linee-modal-world-book" class="linee-modal hidden" style="z-index: 200;">
                        <div class="linee-modal-content" style="max-height: 80vh; overflow-y: auto;">
                            <h3>üåç ‰∏ñÁïå‰π¶ÁÆ°ÁêÜ</h3>
                            <div style="margin-bottom: 15px;">
                                <label style="font-size: 12px; color: #666;">ÂÖ®Â±ÄËÆæÂÆö (Global)</label>
                                <div id="world-entries-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px; margin-bottom: 10px;">
                                    <!-- Dynamic Entries -->
                                    <div style="color: #999; font-size: 12px; text-align: center;">ÊöÇÊó†Êù°ÁõÆ</div>
                                </div>
                                <div style="display: flex; gap: 5px;">
                                    <input type="text" id="world-key" placeholder="ÂÖ≥ÈîÆËØç" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                                    <input type="text" id="world-content" placeholder="ÂÜÖÂÆπÊèèËø∞" style="flex: 2; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                                    <button onclick="addWorldEntry()" style="padding: 0 12px; background: #A0D8EF; color: white; border: none; border-radius: 6px;">+</button>
                                </div>
                            </div>
                            <div class="linee-modal-actions">
                                <button class="linee-btn-confirm" onclick="closeLineeModal('linee-modal-world-book')">ÂÆåÊàê</button>
                            </div>
                        </div>
                    </div>

                    <!-- Import Card Modal -->
                    <div id="linee-modal-import-card" class="linee-modal hidden" style="z-index: 200;">
                        <div class="linee-modal-content">
                            <h3>üì• ÂØºÂÖ•ËßíËâ≤Âç°</h3>
                            <p style="font-size: 12px; color: #666; margin-bottom: 15px;">ÊîØÊåÅ TavernAI Ê†ºÂºèÂõæÁâá (PNG) Êàñ JSON Êñá‰ª∂„ÄÇ</p>
                            <input type="file" id="import-card-file" accept=".png,.json" style="width: 100%; margin-bottom: 15px;">
                            <div class="linee-modal-actions">
                                <button class="linee-btn-cancel" onclick="closeLineeModal('linee-modal-import-card')">ÂèñÊ∂à</button>
                                <button class="linee-btn-confirm" onclick="confirmImportCard()">ÂØºÂÖ•</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Linee ‰∏™‰∫∫ËÆæÂÆöÈ°µ -->
            <!-- Chat Settings Page -->
            <div id="chat-settings-page" class="app-window hidden">
                <div style="height: 100%; display: flex; flex-direction: column; background: #F7F7F7;">
                    <!-- Header -->
                    <div style="background: white; border-bottom: 1px solid #E5E7EB; padding: 48px 16px 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <button onclick="closeChatSettings()" style="width: 32px; height: 32px; border: none; background: transparent; color: #A0D8EF; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                ‚Üê
                            </button>
                            <h1 style="margin: 0; font-size: 18px; font-weight: 700; color: #1f2937;">ËÅäÂ§©ËÆæÂÆö</h1>
                        </div>
                    </div>

                    <!-- Content (Scrollable) -->
                    <div style="flex: 1; overflow-y: auto; padding-bottom: 100px;">
                        
                        <!-- Block A: Logic & World -->
                        <div style="margin-top: 20px;">
                            <div style="padding: 8px 16px; font-size: 11px; font-weight: 600; color: #9CA3AF; text-transform: uppercase; letter-spacing: 0.5px;">AI ÈÖçÁΩÆ</div>
                            <div style="background: white; border-top: 1px solid #E5E7EB; border-bottom: 1px solid #E5E7EB;">
                                <!-- World Book Links -->
                                <!-- Global World Books -->
                                <div onclick="selectChatGlobalWorldBooks()" style="display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; cursor: pointer; border-bottom: 1px solid #F3F4F6;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <ion-icon name="planet-outline" style="font-size: 20px; color: #3B82F6;"></ion-icon>
                                        <span style="font-size: 14px; color: #1f2937;">ÂÖ®Â±Ä‰∏ñÁïå‰π¶</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span id="selected-global-worldbooks" style="font-size: 13px; color: #9CA3AF;">Êú™ÈÄâÊã©</span>
                                        <ion-icon name="chevron-forward-outline" style="font-size: 16px; color: #D1D5DB;"></ion-icon>
                                    </div>
                                </div>
                                
                                <!-- Local World Books -->
                                <div onclick="selectChatLocalWorldBooks()" style="display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; cursor: pointer; border-bottom: 1px solid #F3F4F6;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <ion-icon name="book-outline" style="font-size: 20px; color: #10B981;"></ion-icon>
                                        <span style="font-size: 14px; color: #1f2937;">Â±ÄÈÉ®‰∏ñÁïå‰π¶</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span id="selected-local-worldbooks" style="font-size: 13px; color: #9CA3AF;">Êú™ÈÄâÊã©</span>
                                        <ion-icon name="chevron-forward-outline" style="font-size: 16px; color: #D1D5DB;"></ion-icon>
                                    </div>
                                </div>
                                
                                <!-- Streaming -->
                                <div style="display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid #F3F4F6;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <ion-icon name="flash-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                        <span style="font-size: 14px; color: #1f2937;">ÊµÅÂºèËæìÂá∫</span>
                                    </div>
                                    <label class="chat-switch">
                                        <input type="checkbox" id="streaming-toggle">
                                        <span class="chat-slider"></span>
                                    </label>
                                </div>
                                
                                <!-- Time Sync -->
                                <div style="display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid #F3F4F6;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <ion-icon name="time-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                        <span style="font-size: 14px; color: #1f2937;">Êó∂Èó¥ÂêåÊ≠•</span>
                                    </div>
                                    <label class="chat-switch">
                                        <input type="checkbox" id="timesync-toggle">
                                        <span class="chat-slider"></span>
                                    </label>
                                </div>
                                
                                <!-- Context Limit -->
                                <div style="padding: 14px 16px;">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <ion-icon name="layers-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                        <span style="font-size: 14px; color: #1f2937;">‰∏ä‰∏ãÊñáËÆ∞ÂøÜ</span>
                                        <span id="context-value" style="margin-left: auto; font-size: 13px; color: #A0D8EF; font-weight: 600;">20 Êù°</span>
                                    </div>
                                    <input type="range" id="context-slider" min="5" max="50" value="20" style="width: 100%; height: 4px; border-radius: 2px; background: #E5E7EB; outline: none; -webkit-appearance: none; appearance: none;">
                                </div>
                            </div>
                        </div>

                        <!-- Block B: Persona & Role -->
                        <div style="margin-top: 20px;">
                            <div style="padding: 8px 16px; font-size: 11px; font-weight: 600; color: #9CA3AF; text-transform: uppercase; letter-spacing: 0.5px;">ËßíËâ≤‰∏éÊâÆÊºî</div>
                            <div style="background: white; border-top: 1px solid #E5E7EB; border-bottom: 1px solid #E5E7EB;">
                                <!-- Character Profile -->
                                <div onclick="toggleCharacterProfile()" style="display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; cursor: pointer;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <ion-icon name="person-circle-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                        <span style="font-size: 14px; color: #1f2937;">ÂΩìÂâçËßíËâ≤ËÆæÁΩÆ</span>
                                    </div>
                                    <ion-icon id="char-profile-arrow" name="chevron-forward-outline" style="font-size: 16px; color: #D1D5DB; transition: transform 0.3s;"></ion-icon>
                                </div>
                                
                                <!-- Expandable Character Details -->
                                <div id="character-details" style="display: none; border-top: 1px solid #F3F4F6; padding: 16px; background: #F9FAFB;">
                                    <div style="margin-bottom: 12px;">
                                        <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 6px;">ÂßìÂêç</label>
                                        <input type="text" id="char-name-input" placeholder="ËæìÂÖ•ËßíËâ≤ÂßìÂêç..." style="width: 100%; padding: 8px 12px; border: 1px solid #E5E7EB; border-radius: 8px; background: white; font-size: 13px; outline: none;">
                                    </div>
                                    <div style="margin-bottom: 12px;">
                                        <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 6px;">Â§áÊ≥®ÊòµÁß∞</label>
                                        <input type="text" id="char-nickname-input" placeholder="Ê∑ªÂä†Â§áÊ≥®ÊòµÁß∞..." style="width: 100%; padding: 8px 12px; border: 1px solid #E5E7EB; border-radius: 8px; background: white; font-size: 13px; outline: none;">
                                    </div>
                                    <div style="margin-bottom: 12px;">
                                        <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 6px;">Â§¥ÂÉè</label>
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="uploadCharAvatar()" style="padding: 8px 16px; border: 1px solid #E5E7EB; background: white; border-radius: 8px; font-size: 13px; color: #374151; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                                <ion-icon name="cloud-upload-outline"></ion-icon> ‰∏ä‰º†
                                            </button>
                                            <input type="text" id="char-avatar-url" placeholder="ÊàñËæìÂÖ•ÂõæÁâá URL" style="flex: 1; padding: 8px 12px; border: none; border-bottom: 1px solid #E5E7EB; background: transparent; font-size: 13px; outline: none;">
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 6px;">ËÉåÊôØ/ÊÄßÊ†º</label>
                                        <textarea id="char-background" placeholder="ÊèèËø∞ËßíËâ≤ÁöÑËÉåÊôØÊïÖ‰∫ãÂíåÊÄßÊ†º..." style="width: 100%; min-height: 80px; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 13px; resize: vertical; background: white;"></textarea>
                                    </div>
                                </div>
                                
                                <!-- User Persona Slots -->
                                <div style="border-top: 1px solid #F3F4F6; padding: 16px;">
                                    <div style="font-size: 13px; color: #374151; margin-bottom: 12px; font-weight: 600;">ÊàëÁöÑÂç°ÊßΩ</div>
                                    <div style="display: flex; gap: 8px;">
                                        <div onclick="selectPersonaSlot(0)" data-slot="0" class="persona-slot active" style="flex: 1; aspect-ratio: 1; border: 2px solid #A0D8EF; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; background: white; position: relative;">
                                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #E5E7EB; margin-bottom: 6px;"></div>
                                            <span style="font-size: 11px; color: #6B7280;">Âç°ÊßΩ A</span>
                                            <ion-icon name="checkmark-circle" style="position: absolute; top: 4px; right: 4px; font-size: 16px; color: #A0D8EF;"></ion-icon>
                                        </div>
                                        <div onclick="selectPersonaSlot(1)" data-slot="1" class="persona-slot" style="flex: 1; aspect-ratio: 1; border: 2px solid #E5E7EB; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; background: white; position: relative;">
                                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #E5E7EB; margin-bottom: 6px;"></div>
                                            <span style="font-size: 11px; color: #6B7280;">Âç°ÊßΩ B</span>
                                        </div>
                                        <div onclick="selectPersonaSlot(2)" data-slot="2" class="persona-slot" style="flex: 1; aspect-ratio: 1; border: 2px solid #E5E7EB; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; background: white; position: relative;">
                                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #E5E7EB; margin-bottom: 6px;"></div>
                                            <span style="font-size: 11px; color: #6B7280;">Âç°ÊßΩ C</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Block C: Appearance -->
                        <div style="margin-top: 20px;">
                            <div style="padding: 8px 16px; font-size: 11px; font-weight: 600; color: #9CA3AF; text-transform: uppercase; letter-spacing: 0.5px;">Â§ñËßÇ‰∏é‰∏ªÈ¢ò</div>
                            <div style="background: white; border-top: 1px solid #E5E7EB; border-bottom: 1px solid #E5E7EB;">
                                <!-- Chat Background -->
                                <div style="padding: 14px 16px; border-bottom: 1px solid #F3F4F6;">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <ion-icon name="image-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                        <span style="font-size: 14px; color: #1f2937;">ËÅäÂ§©ËÉåÊôØ</span>
                                    </div>
                                    <div style="display: flex; gap: 8px; align-items: center;">
                                        <div id="chat-bg-preview" style="width: 60px; height: 60px; border-radius: 8px; background: #F3F4F6; overflow: hidden;">
                                            <img src="" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                                        </div>
                                        <button onclick="uploadChatBackground()" style="flex: 1; padding: 10px; border: 1px solid #A0D8EF; background: transparent; color: #A0D8EF; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer;">
                                            <ion-icon name="cloud-upload-outline"></ion-icon> ‰∏ä‰º†ÂõæÁâá
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Bubble Theme -->
                                <div style="padding: 14px 16px;">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <ion-icon name="chatbubble-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                        <span style="font-size: 14px; color: #1f2937;">Ê∞îÊ≥°‰∏ªÈ¢ò</span>
                                    </div>
                                    <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                                        <div onclick="selectBubbleColor('#A0D8EF')" data-color="#A0D8EF" class="bubble-color active" style="width: 36px; height: 36px; border-radius: 50%; background: #A0D8EF; cursor: pointer; border: 3px solid #A0D8EF; box-shadow: 0 0 0 2px white, 0 0 0 4px #A0D8EF;"></div>
                                        <div onclick="selectBubbleColor('#3b82f6')" data-color="#3b82f6" class="bubble-color" style="width: 36px; height: 36px; border-radius: 50%; background: #3b82f6; cursor: pointer; border: 3px solid white;"></div>
                                        <div onclick="selectBubbleColor('#ec4899')" data-color="#ec4899" class="bubble-color" style="width: 36px; height: 36px; border-radius: 50%; background: #ec4899; cursor: pointer; border: 3px solid white;"></div>
                                        <div onclick="selectBubbleColor('#f59e0b')" data-color="#f59e0b" class="bubble-color" style="width: 36px; height: 36px; border-radius: 50%; background: #f59e0b; cursor: pointer; border: 3px solid white;"></div>
                                        <div onclick="selectBubbleColor('#8b5cf6')" data-color="#8b5cf6" class="bubble-color" style="width: 36px; height: 36px; border-radius: 50%; background: #8b5cf6; cursor: pointer; border: 3px solid white;"></div>
                                    </div>
                                    <button onclick="toggleAdvancedCSS()" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; background: white; color: #6B7280; border-radius: 8px; font-size: 13px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px;">
                                        <ion-icon name="code-outline"></ion-icon> È´òÁ∫ß CSS
                                        <ion-icon id="css-arrow" name="chevron-down-outline" style="font-size: 14px; margin-left: auto; transition: transform 0.3s;"></ion-icon>
                                    </button>
                                    <textarea id="chat-custom-css" placeholder="ËæìÂÖ•Ëá™ÂÆö‰πâ CSS ‰ª£Á†Å..." style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 12px; font-family: 'Courier New', monospace; resize: vertical; margin-top: 10px; display: none; background: #1f2937; color: #10b981; box-sizing: border-box;"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Block D: Interaction -->
                        <div style="margin-top: 20px;">
                            <div style="padding: 8px 16px; font-size: 11px; font-weight: 600; color: #9CA3AF; text-transform: uppercase; letter-spacing: 0.5px;">‰∫§‰∫í‰π†ÊÉØ</div>
                            <div style="background: white; border-top: 1px solid #E5E7EB; border-bottom: 1px solid #E5E7EB;">
                                <!-- Offline Mode -->
                                <div style="padding: 14px 16px; border-bottom: 1px solid #F3F4F6;">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <ion-icon name="book-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                            <span style="font-size: 14px; color: #1f2937;">Á∫ø‰∏ãÊ®°Âºè (ÁΩëÊñáÈòÖËØª)</span>
                                        </div>
                                        <label class="chat-switch">
                                            <input type="checkbox" id="offline-mode-toggle">
                                            <span class="chat-slider"></span>
                                        </label>
                                    </div>
                                    <p style="margin: 0; padding-left: 32px; font-size: 12px; color: #9CA3AF;">ÂºÄÂêØÂêé‰ΩøÁî®ÁΩëÊñáËäÇÂ•èÂèô‰∫ãÔºåÂÖ≥Èó≠Âàô‰∏∫Âç≥Êó∂ËÅäÂ§©Ê®°Âºè</p>
                                </div>
                                
                                <!-- Auto Reply -->
                                <div style="padding: 14px 16px; border-bottom: 1px solid #F3F4F6;">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <ion-icon name="chatbox-ellipses-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                            <span style="font-size: 14px; color: #1f2937;">Ëá™Âä®ÂõûÂ§ç</span>
                                        </div>
                                        <label class="chat-switch">
                                            <input type="checkbox" id="autoreply-toggle">
                                            <span class="chat-slider"></span>
                                        </label>
                                    </div>
                                    <p style="margin: 0; padding-left: 32px; font-size: 12px; color: #9CA3AF;">ÂÖ≥Èó≠ÂêéÂèëÈÄÅÊ∂àÊÅØ‰∏ç‰ºöÁ´ãÂç≥ÂõûÂ§ç</p>
                                </div>
                                
                                <!-- Enter to Send -->
                                <div style="display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid #F3F4F6;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <ion-icon name="return-down-forward-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                        <span style="font-size: 14px; color: #1f2937;">ÂõûËΩ¶ÂèëÈÄÅ</span>
                                    </div>
                                    <label class="chat-switch">
                                        <input type="checkbox" id="enter-send-toggle" checked>
                                        <span class="chat-slider"></span>
                                    </label>
                                </div>
                                
                                <!-- Allow Calls -->
                                <div style="padding: 14px 16px; border-bottom: 1px solid #F3F4F6;">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <ion-icon name="call-outline" style="font-size: 20px; color: #6B7280;"></ion-icon>
                                            <span style="font-size: 14px; color: #1f2937;">ÂÖÅËÆ∏‰∏ªÂä®ÈÄöËØù</span>
                                        </div>
                                        <label class="chat-switch">
                                            <input type="checkbox" id="allow-calls-toggle">
                                            <span class="chat-slider"></span>
                                        </label>
                                    </div>
                                    <p style="margin: 0; padding-left: 32px; font-size: 12px; color: #9CA3AF;">ÂÖÅËÆ∏ËßíËâ≤‰∏ªÂä®ÂèëËµ∑ËØ≠Èü≥ÊàñËßÜËÆØËØ∑Ê±Ç</p>
                                </div>
                                
                                <!-- Delete Chat History -->
                                <div style="padding: 14px 16px;">
                                    <button onclick="deleteChatHistory()" style="width: 100%; padding: 12px; background: #FEE2E2; border: 1px solid #FCA5A5; border-radius: 8px; color: #DC2626; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s;">
                                        <ion-icon name="trash-outline" style="font-size: 18px;"></ion-icon>
                                        <span>Ê∏ÖÁ©∫ËÅäÂ§©ËÆ∞ÂΩï</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Fixed Save Button -->
                    <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 12px 16px; background: white; border-top: 1px solid #E5E7EB;">
                        <button onclick="saveAllChatSettings()" style="width: 100%; padding: 12px; border: 2px solid #A0D8EF; background: transparent; color: #A0D8EF; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                            ‰øùÂ≠òËÆæÂÆö
                        </button>
                    </div>
                </div>

                <!-- Hidden File Inputs -->
                <input type="file" id="char-avatar-file" accept="image/*" style="display: none;" onchange="handleCharAvatarUpload(event)">
                <input type="file" id="chat-bg-file" accept="image/*" style="display: none;" onchange="handleChatBgUpload(event)">
            </div>

            <!-- Friend Profile Page -->
            <div id="friend-profile-page" class="app-window hidden">
                <div style="position: relative; height: 100%; background: #F9FAFB; overflow-y: auto;">
                    <!-- Background Banner -->
                    <div id="friend-profile-banner" style="position: relative; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); overflow: hidden;">
                        <img id="friend-profile-bg-img" src="" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                        <div style="position: absolute; top: 50px; left: 16px; right: 16px; display: flex; justify-content: space-between; align-items: center; z-index: 10;">
                            <button onclick="closeFriendProfile()" style="width: 36px; height: 36px; border: none; background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); border-radius: 50%; color: white; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                ‚Üê
                            </button>
                            <button onclick="openBgUploader()" style="padding: 8px 16px; border: none; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 20px; color: #333; font-size: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                <ion-icon name="image-outline"></ion-icon> Êõ¥Êç¢ËÉåÊôØ
                            </button>
                        </div>
                    </div>

                    <!-- Profile Content -->
                    <div style="position: relative; margin-top: -50px; padding: 0 20px 20px;">
                        <!-- Avatar Section -->
                        <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 20px;">
                            <div style="position: relative;">
                                <div id="friend-profile-avatar" style="width: 100px; height: 100px; border-radius: 50%; background: #E5E7EB; border: 4px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden;">
                                    <img id="friend-profile-avatar-img" src="" style="width: 100%; height: 100%; object-fit: cover;">
                                </div>
                                <button onclick="openAvatarUploader()" style="position: absolute; bottom: 0; right: 0; width: 32px; height: 32px; border: 2px solid white; background: #A0D8EF; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                                    <ion-icon name="camera-outline"></ion-icon>
                                </button>
                            </div>
                            <h2 id="friend-profile-name" style="margin: 12px 0 4px 0; font-size: 20px; font-weight: 700; color: #111827;"></h2>
                            <p id="friend-profile-status" style="margin: 0; font-size: 13px; color: #6B7280;"></p>
                        </div>

                        <!-- Name & Nickname Card -->
                        <div style="background: white; border-radius: 16px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h3 style="margin: 0; font-size: 14px; font-weight: 700; color: #111827;">Â•ΩÂèã‰ø°ÊÅØ</h3>
                                <button onclick="toggleEditNameNickname()" id="edit-name-btn" style="padding: 6px 12px; border: 1px solid #E5E7EB; background: white; border-radius: 8px; color: #6B7280; font-size: 12px; cursor: pointer;">
                                    <ion-icon name="create-outline"></ion-icon> ÁºñËæë
                                </button>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">ÂßìÂêç</label>
                                <input type="text" id="friend-profile-name-input" placeholder="ËæìÂÖ•ÂßìÂêç..." style="width: 100%; padding: 8px 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px; font-family: inherit;" readonly>
                            </div>
                            <div>
                                <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Â§áÊ≥®ÊòµÁß∞</label>
                                <input type="text" id="friend-profile-nickname" placeholder="Ê∑ªÂä†Â§áÊ≥®ÊòµÁß∞..." style="width: 100%; padding: 8px 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px; font-family: inherit;" readonly>
                            </div>
                            <div id="name-save-section" style="display: none; margin-top: 10px; text-align: right;">
                                <button onclick="saveNameNickname()" style="padding: 8px 16px; border: none; background: #A0D8EF; color: white; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer;">‰øùÂ≠ò</button>
                            </div>
                        </div>

                        <!-- Birthday & Favorite Card -->
                        <div style="background: white; border-radius: 16px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 12px;">
                            <h3 style="margin: 0 0 12px 0; font-size: 14px; font-weight: 700; color: #111827;">ÁîüÊó•‰∏éÊ†áËÆ∞</h3>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">ÁîüÊó• (Êúà-Êó•)</label>
                                <input type="text" id="friend-profile-birthday" placeholder="‰æãÂ¶Ç: 03-15" pattern="\d{2}-\d{2}" maxlength="5" style="width: 100%; padding: 8px 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px; font-family: inherit;">
                                <div style="font-size: 11px; color: #9CA3AF; margin-top: 4px;">Ê†ºÂºèÔºöMM-DD (‰æã: 03-15 Ë°®Á§∫3Êúà15Êó•)</div>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px 0;">
                                <label style="font-size: 13px; color: #374151; display: flex; align-items: center; gap: 6px;">
                                    <ion-icon name="star" style="color: #FBBF24;"></ion-icon> ËÆæ‰∏∫ÊúÄÁà±
                                </label>
                                <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                    <input type="checkbox" id="friend-profile-favorite" style="opacity: 0; width: 0; height: 0;">
                                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #E5E7EB; transition: .4s; border-radius: 24px;" onclick="toggleFavorite()">
                                        <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                                    </span>
                                </label>
                            </div>
                            <div style="margin-top: 10px; text-align: right;">
                                <button onclick="saveBirthdayAndFavorite()" style="padding: 8px 16px; border: none; background: #A0D8EF; color: white; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer;">‰øùÂ≠ò</button>
                            </div>
                        </div>

                        <!-- ‚úÖ AI ËßíËâ≤ËØ¶ÁªÜËÆæÂÆöÂç°Áâá -->
                        <div id="friend-character-settings-card" style="background: white; border-radius: 16px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 12px;">
                            <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #111827;">‚ú® ËßíËâ≤ËÆæÂÆö</h3>
                            
                            <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                                <div style="flex: 1;">
                                    <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">ÊÄßÂà´</label>
                                    <select id="friend-profile-gender" style="width: 100%; padding: 8px 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 13px;">
                                        <option value="Áî∑">Áî∑</option>
                                        <option value="Â•≥">Â•≥</option>
                                        <option value="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ</option>
                                    </select>
                                </div>
                                <div style="flex: 2;">
                                    <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Ë∫´‰ªΩ/ËÅå‰∏ö</label>
                                    <input type="text" id="friend-profile-identity" placeholder="‰æãÂ¶ÇÔºö28Â≤ÅÈú∏ÈÅìÊÄªË£Å" style="width: 100%; padding: 8px 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 13px;">
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Â§ñË≤åÁâπÂæÅ</label>
                                <textarea id="friend-profile-appearance" placeholder="ÊèèËø∞ËßíËâ≤ÁöÑÂ§ñË≤å„ÄÅÁ©øÁùÄ„ÄÅÊ∞îË¥®..." rows="3" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 13px; resize: vertical;"></textarea>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">ËÉåÊôØÊïÖ‰∫ã</label>
                                <textarea id="friend-profile-background" placeholder="ÊèèËø∞ËßíËâ≤ÁöÑËÉåÊôØÊïÖ‰∫ã„ÄÅÁªèÂéÜ„ÄÅÊÄßÊ†º..." rows="4" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 13px; resize: vertical;"></textarea>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">ÊÄßÊ†ºÊ†áÁ≠æ (Áî®ÈÄóÂè∑ÂàÜÈöî)</label>
                                <input type="text" id="friend-profile-tags" placeholder="‰æãÂ¶ÇÔºöÂÇ≤Â®á„ÄÅÈ´òÂÜ∑„ÄÅÊ∏©Êüî" style="width: 100%; padding: 8px 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 13px;">
                            </div>
                            
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">ÂØπËØùÈ£éÊ†º</label>
                                <select id="friend-profile-style" style="width: 100%; padding: 8px 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 13px;">
                                    <option value="Áé∞‰ª£Êó•Â∏∏ (ÈªòËÆ§)">Áé∞‰ª£Êó•Â∏∏ (ÈªòËÆ§)</option>
                                    <option value="Âè§È£é (Âêæ, Ê±ù, ÁîöÂ•Ω)">Âè§È£é</option>
                                    <option value="ÁøªËØëËÖî (Âì¶, ÊàëÁöÑËÄÅ‰ºôËÆ°)">ÁøªËØëËÖî</option>
                                    <option value="‰∫åÊ¨°ÂÖÉ (È¢úÊñáÂ≠ó)">‰∫åÊ¨°ÂÖÉ</option>
                                    <option value="ËµõÂçöÊúãÂÖã">ËµõÂçöÊúãÂÖã</option>
                                </select>
                            </div>
                            
                            <button onclick="saveFriendCharacterSettings()" style="width: 100%; padding: 12px; border: none; background: #A0D8EF; color: white; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                                ‚úÖ ‰øùÂ≠òËßíËâ≤ËÆæÂÆö
                            </button>
                        </div>

                        <!-- World Books Card (Only for AI Characters) -->
                        <div id="friend-worldbook-card" style="display: none; background: white; border-radius: 16px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <ion-icon name="planet-outline" style="font-size: 18px; color: #A0D8EF;"></ion-icon>
                                <h3 style="margin: 0; font-size: 14px; font-weight: 700; color: #111827;">ÂÖ≥ËÅî‰∏ñÁïå‰π¶</h3>
                            </div>
                            
                            <!-- ÂÖ®Â±Ä‰∏ñÁïå‰π¶ -->
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 6px;">üåç ÂÖ®Â±Ä‰∏ñÁïå‰π¶</label>
                                <div id="friend-global-worldbooks" style="min-height: 40px; padding: 8px; border: 1px solid #E5E7EB; border-radius: 8px; background: #F9FAFB; font-size: 13px;">
                                    <span style="color: #9CA3AF;">Êú™ÈÄâÊã©ÂÖ®Â±Ä‰∏ñÁïå‰π¶</span>
                                </div>
                                <button onclick="selectGlobalWorldBooks()" style="width: 100%; margin-top: 6px; padding: 8px; border: 1px solid #A0D8EF; background: white; color: #A0D8EF; border-radius: 8px; font-size: 12px; cursor: pointer;">ÈÄâÊã©ÂÖ®Â±Ä‰∏ñÁïå‰π¶</button>
                            </div>
                            
                            <!-- Â±ÄÈÉ®‰∏ñÁïå‰π¶ -->
                            <div>
                                <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 6px;">üìö Â±ÄÈÉ®‰∏ñÁïå‰π¶</label>
                                <div id="friend-local-worldbooks" style="min-height: 40px; padding: 8px; border: 1px solid #E5E7EB; border-radius: 8px; background: #F9FAFB; font-size: 13px;">
                                    <span style="color: #9CA3AF;">Êú™ÈÄâÊã©Â±ÄÈÉ®‰∏ñÁïå‰π¶</span>
                                </div>
                                <button onclick="selectLocalWorldBooks()" style="width: 100%; margin-top: 6px; padding: 8px; border: 1px solid #A0D8EF; background: white; color: #A0D8EF; border-radius: 8px; font-size: 12px; cursor: pointer;">ÈÄâÊã©Â±ÄÈÉ®‰∏ñÁïå‰π¶</button>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 10px;">
                            <button onclick="sendMessageToFriend()" style="flex: 1; padding: 14px; border: none; background: #A0D8EF; color: white; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px;">
                                <ion-icon name="chatbubble-outline"></ion-icon> ÂèëÈÄÅÊ∂àÊÅØ
                            </button>
                            <button onclick="deleteFriend()" style="padding: 14px 20px; border: 1px solid #E5E7EB; background: white; color: #EF4444; border-radius: 12px; font-size: 14px; cursor: pointer;">
                                <ion-icon name="trash-outline"></ion-icon>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Hidden File Inputs -->
                <input type="file" id="friend-avatar-upload" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                <input type="file" id="friend-bg-upload" accept="image/*" style="display: none;" onchange="handleBgUpload(event)">
            </div>

            <div id="linee-profile-settings" class="app-window hidden">
                <div id="linee-settings-header">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <button class="linee-icon-btn" onclick="closeLineeProfileSettings()"><ion-icon name="arrow-back-outline"></ion-icon></button>
                        <div class="linee-title">‰∏™‰∫∫ËÆæÂÆö</div>
                    </div>
                    <div></div>
                </div>
                <div class="linee-settings-content">
                    <!-- ÂΩìÂâçÁºñËæëÂå∫ -->
                    <div class="linee-settings-edit">
                        <div class="linee-settings-avatar-section">
                            <div class="linee-settings-avatar-wrapper">
                                <img id="linee-edit-avatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Avatar">
                                <button class="linee-avatar-change-btn" onclick="uploadPersonalAvatar()">
                                    <ion-icon name="camera-outline"></ion-icon>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Hidden File Input for Avatar Upload -->
                        <input type="file" id="personal-avatar-upload" accept="image/*" style="display: none;" onchange="handlePersonalAvatarUpload(event)">
                        <div class="linee-settings-input-group">
                            <label>ÂêçÂ≠ó</label>
                            <input type="text" id="linee-edit-name" placeholder="ËæìÂÖ•ÂêçÂ≠ó" value="ÊàëÁöÑÂêçÂ≠ó">
                        </div>
                        <div class="linee-settings-input-group">
                            <label>Áä∂ÊÄÅÊ∂àÊÅØ</label>
                            <input type="text" id="linee-edit-status-input" placeholder="ËÆæÂÆöÁä∂ÊÄÅÊ∂àÊÅØ..." value="ËÆæÂÆöÁä∂ÊÄÅÊ∂àÊÅØ..." maxlength="20">
                        </div>
                        <div class="linee-settings-input-group">
                            <label>ÊàëÁöÑËÆæÂÆö</label>
                            <textarea id="linee-edit-settings" placeholder="ËæìÂÖ•ÊàëÁöÑËÆæÂÆö..." rows="5"></textarea>
                        </div>
                        
                        <!-- AI Creative Tools -->
                        <div class="linee-settings-group" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; display: none;">
                            <h4 style="margin-bottom: 10px; font-size: 14px; color: #666;">ü§ñ AI ÂàõÊÑèÂ∑•Âùä</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button onclick="openCreateCharModal()" style="padding: 10px; background: #f0f4ff; border: 1px solid #dbeafe; border-radius: 12px; color: #4b5563; font-size: 13px; cursor: pointer;">‚ú® È´òÁ∫ßÂàõËßí</button>
                                <button onclick="openWorldBookModal()" style="padding: 10px; background: #f0f4ff; border: 1px solid #dbeafe; border-radius: 12px; color: #4b5563; font-size: 13px; cursor: pointer;">üåç ‰∏ñÁïå‰π¶</button>
                                <button onclick="openImportCardModal()" style="padding: 10px; background: #f0f4ff; border: 1px solid #dbeafe; border-radius: 12px; color: #4b5563; font-size: 13px; cursor: pointer; grid-column: span 2;">üì• ÂØºÂÖ•ËßíËâ≤Âç° (V2)</button>
                            </div>
                        </div>

                        <button class="linee-save-profile-btn" onclick="saveLineeProfile()">‰øùÂ≠òËá≥Âç°ÊßΩ</button>
                    </div>

                    <!-- ‰∫∫Áâ©Âç°Âå∫ -->
                    <div class="linee-persona-cards-section">
                        <h4>‰∫∫Áâ©Âç°</h4>
                        <div class="linee-persona-cards-grid">
                            <div class="linee-persona-card" data-slot="0" onclick="selectPersonaCard(0)">
                                <div class="linee-persona-card-avatar">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="">
                                </div>
                                <div class="linee-persona-card-info">
                                    <div class="linee-persona-card-name">ÊàëÁöÑÂêçÂ≠ó</div>
                                    <div class="linee-persona-card-status">ËÆæÂÆöÁä∂ÊÄÅÊ∂àÊÅØ...</div>
                                </div>
                                <div class="linee-persona-card-active">‚úì</div>
                            </div>
                            <div class="linee-persona-card linee-persona-card-empty" data-slot="1" onclick="selectPersonaCard(1)">
                                <div class="linee-persona-card-empty-icon">+</div>
                                <div class="linee-persona-card-empty-text">Á©∫Âç°ÊßΩ</div>
                            </div>
                            <div class="linee-persona-card linee-persona-card-empty" data-slot="2" onclick="selectPersonaCard(2)">
                                <div class="linee-persona-card-empty-icon">+</div>
                                <div class="linee-persona-card-empty-text">Á©∫Âç°ÊßΩ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======== ‰∏ñÁïå‰π¶ÂÖ≥ËÅîÈÄâÊã©È°µÈù¢ (Áã¨Á´ã) ======== -->
            <div id="worldbook-link-selector" class="app-window hidden">
                <div class="app-header" style="background: linear-gradient(135deg, #A0D8EF 0%, #8AC5DB 100%); color: white; padding: 35px 16px 16px;">
                    <button class="back-btn" onclick="closeWorldbookLinkSelector()" style="color: white; background: none; border: none; font-size: 24px; cursor: pointer; padding: 8px;">‚Üê</button>
                    <h3 id="wblink-title" style="margin: 0; flex: 1; text-align: center; font-size: 18px;">ÈÄâÊã©‰∏ñÁïå‰π¶</h3>
                    <button onclick="confirmWorldbookLinkSelection()" style="background: rgba(255,255,255,0.3); border: 2px solid white; color: white; padding: 8px 20px; border-radius: 20px; font-size: 15px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        <i class="fa-solid fa-check"></i> Á°ÆÂÆö
                    </button>
                </div>
                
                <!-- ËÆ°Êï∞ÊòæÁ§∫ -->
                <div id="wblink-count-bar" style="padding: 12px 16px; background: rgba(160, 216, 239, 0.1); border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                    <span id="wblink-count" style="font-size: 14px; font-weight: 600; color: #047857;">Â∑≤ÈÄâ 0 ‰∏™</span>
                    <button onclick="clearWorldbookLinkSelection()" style="background: none; border: none; color: #ef4444; font-size: 12px; cursor: pointer;">Ê∏ÖÁ©∫ÈÄâÊã©</button>
                </div>
                
                <!-- ‰∏ñÁïå‰π¶ÂàóË°® -->
                <div id="wblink-list-container" style="flex: 1; overflow-y: auto; padding: 16px; background: #f9fafb;">
                    <!-- ‰∏ñÁïå‰π¶Âç°ÁâáÂ∞ÜÂú®ËøôÈáåÊ∏≤Êüì -->
                </div>
            </div>

            <div id="worldbook-app" class="app-window hidden">
                <!-- A. Dynamic Header -->
                <div id="wb-header" class="wb-header">
                    <!-- Normal Mode -->
                    <div class="wb-header-normal">
                        <button class="wb-btn-icon" onclick="closeApp()">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <h3 class="wb-title">‰∏ñÁïå‰π¶</h3>
                    </div>
                    
                    <!-- Selection Mode (Hidden by default) -->
                    <div class="wb-header-selection hidden">
                        <div class="flex items-center gap-2">
                            <button class="wb-btn-icon" onclick="wbExitSelectionMode()">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                            <span id="wb-selection-count" class="wb-selection-count">Â∑≤ÈÄâ 0</span>
                        </div>
                        <div class="wb-selection-tools">
                            <button class="wb-btn-icon" onclick="wbMoveItems()" title="ÁßªÂä®">
                                <i class="fa-solid fa-folder-tree"></i>
                            </button>
                            <button class="wb-btn-icon" onclick="wbDownloadItems()" title="‰∏ãËΩΩ">
                                <i class="fa-solid fa-download"></i>
                            </button>
                            <button class="wb-btn-icon danger" onclick="wbDeleteItems()" title="Âà†Èô§">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="wb-tabs">
                    <button class="wb-tab-btn active" onclick="wbSwitchTab('global')" id="wb-tab-global-btn">ÂÖ®Â±Ä‰∏ñÁïå‰π¶</button>
                    <button class="wb-tab-btn" onclick="wbSwitchTab('local')" id="wb-tab-local-btn">Â±ÄÈÉ®‰∏ñÁïå‰π¶</button>
                </div>

                <!-- B. Main Content -->
                <div class="wb-container">
                    
                    <!-- Global Panel -->
                    <div id="wb-panel-global" class="wb-panel active">
                        <div class="wb-panel-header">
                            <h4 class="wb-panel-title">
                                <i class="fa-solid fa-globe"></i> ÂÖ®Â±ÄÊù°ÁõÆ
                            </h4>
                            <div class="wb-panel-actions">
                                <button class="wb-btn-outline" onclick="wbCreateGlobal()" title="Êñ∞Â¢û">
                                    <i class="fa-solid fa-folder-plus"></i>
                                </button>
                                <button class="wb-btn-outline" onclick="wbImportGlobal()" title="ÂØºÂÖ•">
                                    <i class="fa-solid fa-file-import"></i>
                                </button>
                                <button class="wb-btn-outline" onclick="wbExportGlobal()" title="ÂØºÂá∫">
                                    <i class="fa-solid fa-file-export"></i>
                                </button>
                            </div>
                        </div>
                        <!-- List -->
                        <div id="wb-list-global" class="wb-list">
                            <!-- Items will be injected here -->
                        </div>
                    </div>

                    <!-- Local Panel -->
                    <div id="wb-panel-local" class="wb-panel hidden">
                        <div class="wb-panel-header">
                            <h4 class="wb-panel-title">
                                <i class="fa-solid fa-book-bookmark"></i> Â±ÄÈÉ®‰∏ñÁïå‰π¶
                            </h4>
                            <div class="wb-panel-actions">
                                <button class="wb-btn-outline" onclick="wbCreateLocal()" title="Êñ∞Â¢û">
                                    <i class="fa-solid fa-folder-plus"></i>
                                </button>
                                <button class="wb-btn-outline" onclick="wbImportLocal()" title="ÂØºÂÖ•">
                                    <i class="fa-solid fa-file-import"></i>
                                </button>
                                <button class="wb-btn-outline" onclick="wbExportLocal()" title="ÂØºÂá∫">
                                    <i class="fa-solid fa-file-export"></i>
                                </button>
                            </div>
                        </div>
                        <!-- List -->
                        <div id="wb-list-local" class="wb-list">
                            <!-- Items will be injected here -->
                        </div>
                    </div>

                </div>

                <!-- Hidden Inputs for File Operations -->
                <input type="file" id="wb-file-import-global" class="hidden" accept=".json" onchange="handleWbImportGlobal(this)">
                <input type="file" id="wb-file-import-local" class="hidden" accept=".json" onchange="handleWbImportLocal(this)">
            </div>

            <div id="diary-app" class="app-window hidden" style="background:#F9FAFB">
                <div id="diary-home-view" class="diary-view active">
                    <div class="diary-navbar">
                        <button class="diary-navbar-btn" id="diary-back-btn"><ion-icon name="chevron-back-outline"></ion-icon></button>
                        <div class="diary-navbar-title">Êó•ËÆ∞</div>
                        <div style="display:flex;gap:4px">
                            <button class="diary-navbar-btn" onclick="switchDiaryView('favorites')" style="color:#F59E0B"><ion-icon name="folder-open-outline"></ion-icon></button>
                            <button class="diary-navbar-btn" onclick="openDiarySettings()" style="color:#9CA3AF"><ion-icon name="settings-outline"></ion-icon></button>
                        </div>
                    </div>
                    <div id="diary-friends-list" style="flex:1;overflow-y:auto"></div>
                </div>
                <div id="diary-detail-view" class="diary-view">
                    <div class="diary-navbar">
                        <button class="diary-navbar-btn" onclick="switchDiaryView('home')"><ion-icon name="chevron-back-outline"></ion-icon></button>
                        <div class="diary-navbar-title" id="diary-detail-title"></div>
                        <button class="diary-navbar-btn" onclick="openGenerateModal()" style="color:#A0D8EF"><ion-icon name="add-outline"></ion-icon></button>
                    </div>
                    <div id="diary-timeline-container" style="flex:1;overflow-y:auto;padding:20px 16px;background:#F9FAFB"></div>
                </div>
                <div id="diary-favorites-view" class="diary-view">
                    <div class="diary-navbar">
                        <button class="diary-navbar-btn" onclick="switchDiaryView('home')"><ion-icon name="chevron-back-outline"></ion-icon></button>
                        <div class="diary-navbar-title">Êî∂ËóèÁ∞ø</div>
                        <button class="diary-navbar-btn" onclick="openDiarySettings()"><ion-icon name="settings-outline"></ion-icon></button>
                    </div>
                    <div id="diary-favorites-container" style="flex:1;overflow-y:auto;padding:20px 16px;background:#F9FAFB"></div>
                </div>
                <div id="diary-generate-modal" class="diary-modal hidden">
                    <div class="diary-modal-content">
                        <button onclick="closeGenerateModal()" style="position:absolute;top:16px;right:16px;background:none;border:none;color:#9CA3AF;cursor:pointer;font-size:20px"><ion-icon name="close-outline"></ion-icon></button>
                        <div class="diary-modal-title">ÊâãÂä®ÁîüÊàêÊó•ËÆ∞</div>
                        <div style="display:flex;justify-content:space-between;align-items:center;padding:0 8px;margin-bottom:32px">
                            <span style="font-size:14px;font-weight:500;color:#4B5563">ÊòØÂê¶Ë¥¥ÂêàÁé∞ÂÆûÊó∂Èó¥?</span>
                            <div class="diary-toggle active" id="diary-realtime-toggle" onclick="this.classList.toggle('active')">
                                <div class="diary-toggle-knob"></div>
                            </div>
                        </div>
                        <button onclick="generateDiary()" class="diary-modal-btn diary-modal-btn-confirm" style="width:100%;display:flex;align-items:center;justify-content:center;gap:8px">
                            <ion-icon name="sparkles-outline"></ion-icon>
                            <span>ËØªÂèñ‰ªäÊó•ËÆ∞ÂøÜÂπ∂ÁîüÊàê</span>
                        </button>
                    </div>
                </div>
                <div id="diary-settings-modal" class="diary-modal hidden">
                    <div class="diary-modal-content">
                        <div style="background:#F9FAFB;padding:16px 20px;margin:-24px -24px 16px;border-bottom:1px solid #F3F4F6;display:flex;justify-content:space-between;align-items:center">
                            <div style="display:flex;align-items:center;gap:8px;color:#374151;font-weight:700">
                                <ion-icon name="settings-outline" style="font-size:18px"></ion-icon>
                                <span>Êó•ËÆ∞ËÆæÂÆö</span>
                            </div>
                            <button onclick="closeDiarySettings()" style="background:none;border:none;color:#9CA3AF;cursor:pointer;font-size:20px"><ion-icon name="close-outline"></ion-icon></button>
                        </div>
                        <div style="padding:8px 0">
                            <div class="diary-setting-item">
                                <div class="diary-setting-label">
                                    <div class="diary-setting-icon" style="background:#EFF6FF;color:#A0D8EF"><ion-icon name="sparkles-outline"></ion-icon></div>
                                    <div>
                                        <div class="diary-setting-title">Ëá™Âä®ÁîüÊàêÊó•ËÆ∞</div>
                                        <div class="diary-setting-desc">ËÅäÂ§©Êª° 20 Êù°Êó∂Ëß¶Âèë AI ÁîüÊàê</div>
                                    </div>
                                </div>
                                <div class="diary-toggle" id="diary-auto-gen-toggle" onclick="this.classList.toggle('active')">
                                    <div class="diary-toggle-knob"></div>
                                </div>
                            </div>
                            <div style="height:1px;background:#F9FAFB;margin:0 16px"></div>
                            <div class="diary-setting-item">
                                <div class="diary-setting-label">
                                    <div class="diary-setting-icon" style="background:#ECFDF5;color:#10B981"><ion-icon name="location-outline"></ion-icon></div>
                                    <div>
                                        <div class="diary-setting-title">ËÅîÂä®Ë∂≥ËøπÁîüÊàê</div>
                                        <div class="diary-setting-desc">ÁîüÊàêË∂≥ËøπÊó∂ÂêåÊ≠•Êí∞ÂÜôÊó•ËÆ∞</div>
                                    </div>
                                </div>
                                <div class="diary-toggle active" id="diary-sync-footprint-toggle" onclick="this.classList.toggle('active')">
                                    <div class="diary-toggle-knob"></div>
                                </div>
                            </div>
                        </div>
                        <div style="background:#F9FAFB;padding:12px;margin:16px -24px -24px;text-align:center;font-size:11px;color:#9CA3AF">
                            Linee AI System v1.2
                        </div>
                    </div>
                </div>
            </div>

            <div id="chat-window" class="app-window hidden">
                <div class="app-header">
                    <button class="back-btn">‚Üê</button>
                    <h3 id="chat-title">AI Âä©Êâã</h3>
                </div>
                <div id="chat-messages"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="ËæìÂÖ•Ê∂àÊÅØ...">
                    <button id="send-btn">ÂèëÈÄÅ</button>
                </div>
            </div>

            <div id="calendar-app" class="app-window hidden" style="background-color: #f5f5f7;">
                <div class="app-header" style="background-color: #fff; border-bottom: 1px solid #e5e5e5; padding-top: 40px;">
                    <button class="back-btn">‚Üê</button>
                    <h3>Êó•ÂéÜ</h3>
                </div>
                <div style="flex: 1; overflow-y: auto; display: flex; flex-direction: column;">
                    <div id="calendar-full" style="background-color: #fff; margin-bottom: 10px; padding-bottom: 10px;"></div>
                    <div id="memo-area" style="background-color: #fff; flex: 1; padding: 20px; border-top: 1px solid #e5e5e5;">
                        <h4 id="memo-date-title" style="margin-bottom: 15px; color: #333; font-size: 18px;">Â§áÂøòÂΩï</h4>
                        <textarea id="memo-input" placeholder="ÁÇπÂáªÊó•ÊúüÊ∑ªÂä†Â§áÂøòÂΩï..." style="width: 100%; height: 150px; padding: 15px; border: 1px solid #e5e5e5; border-radius: 12px; resize: none; background-color: #f9f9f9; font-size: 16px; line-height: 1.5;"></textarea>
                        <button id="save-memo" style="width: 100%; margin-top: 15px; padding: 12px; background-color: #007AFF; color: #fff; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer;">‰øùÂ≠ò</button>
                    </div>
                </div>
            </div>

            <div id="music-search-modal" class="app-window hidden">
                <div class="app-header">
                    <button class="back-btn">‚Üê</button>
                    <h3>ÊêúÁ¥¢Èü≥‰πê</h3>
                </div>
                <div class="search-area">
                    <input type="text" id="music-search-input" placeholder="ÊêúÁ¥¢Ê≠åÊõ≤ÊàñÊ≠åÊâã...">
                    <button id="do-search">ÊêúÁ¥¢</button>
                </div>
                <div id="search-results"></div>
            </div>

            <div id="music-fav-modal" class="app-window hidden">
                <div class="app-header">
                    <button class="back-btn">‚Üê</button>
                    <h3>ÊàëÁöÑÊ≠åÂçï</h3>
                </div>
                <div id="fav-list"></div>
            </div>

            <div id="add-music-modal" class="app-window hidden">
                <div class="app-header">
                    <button class="back-btn">‚Üê</button>
                    <h3>Ê∑ªÂä†Èü≥‰πê</h3>
                </div>
                <div style="padding:20px;">
                    <div style="margin-bottom:20px;">
                        <label style="display:block;margin-bottom:8px;font-weight:bold;">Ê≠åÊõ≤ÂêçÁß∞</label>
                        <input type="text" id="add-music-title" placeholder="ËæìÂÖ•Ê≠åÊõ≤ÂêçÁß∞" style="width:100%;padding:12px;border-radius:10px;border:2px solid #e8e8e8;font-size:14px;">
                    </div>
                    <div style="margin-bottom:20px;">
                        <label style="display:block;margin-bottom:8px;font-weight:bold;">Ê≠åÊâã</label>
                        <input type="text" id="add-music-artist" placeholder="ËæìÂÖ•Ê≠åÊâãÂêçÁß∞" style="width:100%;padding:12px;border-radius:10px;border:2px solid #e8e8e8;font-size:14px;">
                    </div>
                    <div style="margin-bottom:20px;">
                        <label style="display:block;margin-bottom:8px;font-weight:bold;">Èü≥‰πêÊù•Ê∫ê</label>
                        <input type="url" id="add-music-url" placeholder="Á≤òË¥¥ MP3 ÈìæÊé•Êàñ URL" style="width:100%;padding:12px;border-radius:10px;border:2px solid #e8e8e8;font-size:14px;margin-bottom:10px;">
                        <div style="text-align:center;margin:10px 0;color:#999;font-size:12px;">‚îÄ‚îÄ‚îÄ Êàñ ‚îÄ‚îÄ‚îÄ</div>
                        <input type="file" id="add-music-file" accept="audio/*" style="width:100%;padding:12px;border-radius:10px;border:2px solid #e8e8e8;font-size:14px;">
                        <div style="font-size:11px;color:#999;margin-top:5px;">ÊîØÊåÅ MP3„ÄÅWAV„ÄÅOGG Á≠âÈü≥È¢ëÊ†ºÂºè</div>
                    </div>
                    <button id="confirm-add-music" style="width:100%;padding:15px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:15px;font-size:16px;font-weight:bold;cursor:pointer;">Ê∑ªÂä†Âà∞Êí≠ÊîæÂàóË°®</button>
                </div>
            </div>

            <div id="lyric-float" class="hidden">
                <div id="lyric-text">ÊöÇÊó†Ê≠åËØç</div>
                <button id="close-lyric">√ó</button>
            </div>
        </div>
    </div>

    <input type="file" id="hidden-file-input" accept=".json" style="display:none">
    <input type="file" id="hidden-theme-input" accept=".json" style="display:none">
    <audio id="music-player" style="display:none"></audio>
    <style id="custom-style"></style>
    <style id="custom-font"></style>
    
    <!-- ÊâìÂ≠óÊú∫ÊïàÊûúÊ†∑Âºè -->
    <style>
        /* ÊâìÂ≠óÊ∏∏Ê†áÂä®Áîª */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            margin-left: 2px;
            color: currentColor;
        }
        
        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }
    </style>

    <!-- ======== ÂºÄÂèëËÄÖË∞ÉËØïÈù¢Êùø ======== -->
    <div id="debug-panel" style="position: fixed; top: 10px; right: 10px; z-index: 99999;">
        <button id="debug-toggle-btn" style="
            padding: 10px 15px;
            background: linear-gradient(135deg, #ff4757, #c23616);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.4);
            transition: all 0.3s;
        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
            üêõ Debug
        </button>
        
        <div id="debug-window" style="
            display: none;
            position: fixed;
            top: 60px;
            right: 10px;
            width: 500px;
            max-height: 80vh;
            background: rgba(0, 0, 0, 0.95);
            color: #00ff00;
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff00;
        ">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #00ff00;">
                <h3 style="margin: 0; color: #00ff00; font-size: 16px;">üîç AI Ë∞ÉËØïÈù¢Êùø</h3>
                <button id="debug-close-btn" style="
                    background: transparent;
                    color: #00ff00;
                    border: 1px solid #00ff00;
                    border-radius: 4px;
                    padding: 4px 8px;
                    cursor: pointer;
                    font-size: 16px;
                " onclick="document.getElementById('debug-window').style.display='none'">√ó</button>
            </div>
            
            <div style="margin-bottom: 15px;">
                <h4 style="color: #ffff00; margin-bottom: 8px;">üìã ÂΩìÂâçËÅäÂ§©ËÆæÁΩÆ</h4>
                <div id="debug-settings" style="background: rgba(0, 255, 0, 0.1); padding: 10px; border-radius: 6px; white-space: pre-wrap; word-break: break-word;"></div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <h4 style="color: #ffff00; margin-bottom: 8px;">üë§ ÂΩìÂâçËßíËâ≤‰ø°ÊÅØ</h4>
                <div id="debug-character" style="background: rgba(0, 255, 0, 0.1); padding: 10px; border-radius: 6px; white-space: pre-wrap; word-break: break-word;"></div>
            </div>
            
            <div>
                <h4 style="color: #ffff00; margin-bottom: 8px;">üìù ÊúÄÂêéÂèëÈÄÅÁöÑ System Prompt</h4>
                <div id="debug-prompt" style="background: rgba(0, 255, 0, 0.1); padding: 10px; border-radius: 6px; white-space: pre-wrap; word-break: break-word; max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>
    <!-- ‰ΩøÁî®ÂñÆ‰∏ÄÊñá‰ª∂ÁâàÊú¨ÔºàÊé®Ëñ¶Ôºâ -->
    <script src="js/ai-core.js"></script>
    <script src="js/app-complete.js"></script>
    <script src="js/typewriter.js"></script>
    <script src="js/linee.js"></script>
    <script src="js/linee-enhancements.js"></script>
    <script src="js/worldbook.js"></script>
    <script src="js/worldbook-link-selector.js"></script>
    <script src="js/diary.js"></script>
    <!-- Êàñ‰ΩøÁî®Ê®°Â°äÂåñÁâàÊú¨ÔºàÂèñÊ∂à‰∏ãÈù¢ÁöÑË®ªÈáã‰∏¶Ë®ªÈáãÊéâ‰∏äÈù¢ÁöÑ app.jsÔºâ
    <script src="js/state.js"></script>
    <script src="js/statusbar.js"></script>
    <script src="js/home.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/apps.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/music.js"></script>
    <script src="js/main.js"></script>
    -->
</body>
</html>
