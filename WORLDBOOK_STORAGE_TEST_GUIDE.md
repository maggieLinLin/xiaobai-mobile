# 🧪 世界书本地存储 - 快速测试指南

## 📋 30秒快速测试

### 测试 1: 添加条目自动保存

```
1. 打开世界书 App
   ↓
2. 点击任意世界书进入编辑
   ↓
3. 输入关键词: "测试条目"
   输入描述: "这是一个测试"
   ↓
4. 点击 "添加条目" 按钮
   ✅ 控制台应显示: "✅ 条目已添加并保存: 测试条目"
   ↓
5. 不要点击 "保存" 按钮
   ↓
6. 直接按 F5 刷新页面
   ↓
7. 重新打开该世界书
   ↓
✅ 应该看到 "测试条目" 存在
```

---

### 测试 2: 删除条目自动保存

```
1. 继续使用刚才的世界书
   ↓
2. 点击 "测试条目" 旁边的删除按钮
   ↓
3. 确认删除
   ✅ 控制台应显示: "✅ 条目已删除并保存: 测试条目"
   ↓
4. 不要点击 "保存" 按钮
   ↓
5. 直接按 F5 刷新页面
   ↓
6. 重新打开该世界书
   ↓
✅ "测试条目" 应该已消失
```

---

### 测试 3: 使用验证脚本

```
1. 按 F12 打开控制台
   ↓
2. 复制 verify-worldbook-storage.js 的内容
   ↓
3. 粘贴到控制台并按回车
   ↓
✅ 查看输出:
   - 数据大小
   - 世界书数量
   - 世界书列表
   - 条目数量
```

---

## 🔍 预期控制台输出

### 添加条目时

```
✅ 条目已添加并保存: 测试条目
WorldBook Saved
```

### 删除条目时

```
✅ 条目已删除并保存: 测试条目
WorldBook Saved
```

### 运行验证脚本时

```
🔍 开始验证世界书本地存储...

✅ 找到世界书数据
📏 数据大小: 2.35 KB

📊 数据结构验证:
  - global: ✅
  - local: ✅
  - folders: ✅

📚 世界书统计:
  - 全局世界书: 1 个
  - 局部世界书: 0 个

🌍 全局世界书列表:
  - 主世界书 (ID: global_main)
    条目数: 3

✅ 验证完成!
```

---

## ❌ 常见问题

### Q1: 没有看到 "✅ 条目已添加并保存" 消息?

**原因:** 控制台可能被清空或隐藏了

**解决:**
```
1. 按 F12 打开控制台
2. 确保选择 "Console" 标签
3. 重新添加条目
```

---

### Q2: 刷新后数据仍然丢失?

**检查步骤:**

```javascript
// 在控制台执行
localStorage.getItem('xiaobai-worldbook')
```

**如果返回 `null`:**
- ❌ 数据没有保存成功
- 可能原因: 浏览器隐私模式、localStorage 被禁用

**如果返回一串 JSON:**
- ✅ 数据已保存
- 可能原因: 加载逻辑问题

---

### Q3: 无痕模式下使用

**注意:**
- ⚠️ 无痕模式关闭浏览器后会清空 localStorage
- 💡 建议使用普通模式
- 💡 或定期导出备份

---

## 💾 数据备份方法

### 方法 1: 导出 JSON

```
1. 世界书 App
2. 长按世界书进入批量操作
3. 选择要备份的世界书
4. 点击 "下载" 图标
5. 保存 JSON 文件
```

### 方法 2: 控制台导出

```javascript
// 复制控制台输出,保存为 .json 文件
const data = localStorage.getItem('xiaobai-worldbook');
console.log(JSON.stringify(JSON.parse(data), null, 2));
```

---

## ✅ 测试通过标准

**所有测试通过的标志:**

1. ✅ 添加条目后刷新,条目存在
2. ✅ 删除条目后刷新,条目消失
3. ✅ 控制台显示保存消息
4. ✅ 验证脚本显示正确的数据结构
5. ✅ localStorage 中有 `xiaobai-worldbook` 数据

---

## 🎉 测试成功!

如果以上所有测试都通过,说明世界书本地存储功能正常!

**享受自动保存的便利吧!** 🎊

---

**更多信息:** `WORLDBOOK_STORAGE_FIX.md`


